<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alt Y√ºklenici Rapor Formu</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
      :root {
        --sidebar-width-open: 256px;
        --sidebar-width-closed: 30px;
        --button-size: 30px;
        --button-color: #4b5563;
      }

      /* A√ßƒ±k tema deƒüi≈ükenleri */
      [data-theme="light"] {
        --bg-primary: #f5f7fa;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f1f5f9;
        --text-primary: #2d3748;
        --text-secondary: #6b7280;
        --text-muted: #9ca3af;
        --border-color: #e5e7eb;
        --accent-color: #e5e7eb;
        --input-bg: #ffffff;
        --input-border: #d1d5db;
        --table-header-bg: #f9fafb;
        --table-row-hover: #f9fafb;
        --select-bg: #ffffff;
        --select-text: #2d3748;
        --sidebar-bg: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        --sidebar-text: #2d3748;
        --menu-active-bg: #3b82f6;
        --menu-active-text: #ffffff;
      }

      /* Koyu tema deƒüi≈ükenleri */
      [data-theme="dark"] {
        --bg-primary: #1e293b;
        --bg-secondary: #1a1a1a;
        --bg-tertiary: #252525;
        --text-primary: #f8fafc;
        --text-secondary: #888;
        --text-muted: #666;
        --border-color: #2a2a2a;
        --accent-color: #3a3a3a;
        --input-bg: #0f0f0f;
        --input-border: #333;
        --table-header-bg: #0f0f0f;
        --table-row-hover: #0f0f0f;
        --select-bg: #1a1a1a;
        --select-text: #f8fafc;
        --sidebar-bg: #1a1a1a;
        --sidebar-text: #f8fafc;
        --menu-active-bg: #3b82f6;
        --menu-active-text: #ffffff;
      }

      body {
        background-color: var(--bg-primary);
        color: var(--text-primary);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-size: 13px;
        line-height: 1.5;
        transition: all 0.3s ease;
      }

      /* DARK MODE SELECT OPTION D√úZELTMESƒ∞ */
      [data-theme="dark"] .form-select option {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
      }

      [data-theme="dark"] .form-select option:checked {
        background-color: #3b82f6 !important;
        color: #ffffff !important;
      }

      [data-theme="dark"] .form-select option:hover {
        background-color: #2d3748 !important;
        color: #ffffff !important;
      }

      /* DARK MODE MEN√ú D√úZELTMESƒ∞ - REACT INLINE STIL OVERRIDE */
      [data-theme="dark"] .bg-gray-200,
      [data-theme="dark"] .bg-gray-300 {
        background-color: #1a1a1a !important;
        color: #e0e0e0 !important;
      }

      .sidebar-closed #sidebar-container {
        width: var(--sidebar-width-closed);
      }

      #sidebar-container {
        width: var(--sidebar-width-open);
        transition: width 0.3s ease;
        flex-shrink: 0;
        background: var(--sidebar-bg);
        position: relative;
        border-right: 1px solid var(--border-color);
      }

      #toggle-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        width: var(--button-size);
        height: var(--button-size);
        background-color: var(--button-color);
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 6px;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .sidebar-closed #toggle-btn {
        right: auto;
        left: 0;
        transform: translateX(0);
      }

      #toggle-btn:hover {
        background-color: #6b7280;
      }

      #btn-icon {
        font-size: 18px;
        line-height: 1;
      }

      .sidebar-content {
        transition: opacity 0.3s ease;
        white-space: nowrap;
        overflow: hidden;
        height: 100%;
        box-sizing: border-box;
        color: var(--sidebar-text);
      }

      .sidebar-closed .sidebar-content {
        opacity: 0;
        pointer-events: none;
      }

      .tooltip-text {
        visibility: hidden;
        background-color: #333;
        color: #fff;
        padding: 5px 10px;
        border-radius: 4px;
        position: absolute;
        z-index: 100;
        left: 100%;
        top: 50%;
        transform: translateY(-50%) translateX(10px);
        opacity: 0;
        transition: opacity 0.3s;
        white-space: nowrap;
        font-size: 12px;
      }

      #toggle-btn:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
      }

      /* Custom form elements */
      .form-input {
        width: 100%;
        padding: 0.6rem;
        background: var(--input-bg);
        border: 1px solid var(--input-border);
        border-radius: 4px;
        font-size: 0.8rem;
        color: var(--text-primary);
        transition: all 0.2s;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--text-muted);
      }

      .form-select {
        width: 100%;
        padding: 0.6rem;
        background: var(--select-bg);
        border: 1px solid var(--input-border);
        border-radius: 4px;
        font-size: 0.8rem;
        color: var(--select-text);
        transition: all 0.2s;
      }

      .form-select:focus {
        outline: none;
        border-color: var(--text-muted);
      }

      .form-textarea {
        width: 100%;
        padding: 0.6rem;
        background: var(--input-bg);
        border: 1px solid var(--input-border);
        border-radius: 4px;
        font-size: 0.8rem;
        color: var(--text-primary);
        transition: all 0.2s;
        resize: none;
      }

      .form-textarea:focus {
        outline: none;
        border-color: var(--text-muted);
      }

      /* Button styles */
      .btn {
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 4px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
      }

      .btn-primary {
        background: var(--accent-color);
        color: var(--text-primary);
      }

      .btn-primary:hover {
        background: var(--text-muted);
      }

      .btn-secondary {
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
      }

      .btn-secondary:hover {
        background: var(--bg-tertiary);
      }

      .btn-success {
        background: #10b981;
        color: white;
      }

      .btn-success:hover {
        background: #059669;
      }

      .btn-danger {
        background: #ef4444;
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .btn-edit {
        background: #10b981;
        color: white;
      }

      .btn-edit:hover {
        background: #059669;
      }

      .btn-small {
        padding: 0.3rem 0.6rem;
        font-size: 0.7rem;
      }

      /* Table styles */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        font-size: 0.8rem;
      }

      .data-table th {
        text-align: left;
        padding: 0.8rem;
        font-weight: 500;
        color: var(--text-secondary);
        border-bottom: 1px solid var(--border-color);
        background: var(--table-header-bg);
      }

      .data-table td {
        padding: 0.8rem;
        border-bottom: 1px solid var(--border-color);
      }

      .data-table tr:hover {
        background: var(--table-row-hover);
      }

      /* Manpower table specific styles */
      .manpower-table th:nth-child(1) {
        /* Se√ß s√ºtunu */
        width: 4%;
      }

      .manpower-table th:nth-child(2) {
        /* Personel ID s√ºtunu */
        width: 8%;
      }

      .manpower-table th:nth-child(3) {
        /* Ad Soyad s√ºtunu */
        width: 15%;
      }

      .manpower-table th:nth-child(4) {
        /* Pozisyon s√ºtunu */
        width: 10%;
      }

      .manpower-table th:nth-child(5) {
        /* √áalƒ±≈üma Kategorisi s√ºtunu */
        width: 53%;
      }

      .manpower-table th:nth-child(6) {
        /* Saat s√ºtunu */
        width: 10%;
      }

      .manpower-table td:nth-child(3) {
        /* Ad Soyad h√ºcresi */
        white-space: normal;
        line-height: 1.3;
      }

      .manpower-table td:nth-child(4) {
        /* Pozisyon h√ºcresi */
        white-space: normal;
        line-height: 1.3;
        font-size: 0.75rem;
      }

      .manpower-table td:nth-child(5) {
        /* √áalƒ±≈üma Kategorisi h√ºcresi */
        white-space: normal;
        line-height: 1.3;
      }

      /* Section styles */
      .section {
        background: var(--bg-secondary);
        border-radius: 6px;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        margin-bottom: 1.5rem;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      /* Alt y√ºklenici bilgi √ßer√ßevesini daralt */
      .subcontractor-compact {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
        margin-bottom: 0.75rem;
      }

      .subcontractor-compact .section-header {
        margin-bottom: 0;
        padding: 0.5rem 0;
      }

      /* Proje bilgi √ßer√ßevesini daralt */
      .project-compact {
        padding: 0.5rem 1.5rem;
        margin-bottom: 0.75rem;
      }

      .project-compact p {
        margin: 0;
        line-height: 1.2;
      }

      .section-title {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.6rem;
      }

      .section-title::before {
        content: "";
        width: 3px;
        height: 14px;
        background: var(--text-muted);
        border-radius: 1px;
      }

      /*  SIDEBAR STƒ∞LLERƒ∞  */
      .sidebar-logo-area {
        background: rgba(255, 255, 255, 0.7);
        border-radius: 8px;
        padding: 8px 10px;
        margin-bottom: 10px;
        text-align: center;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      [data-theme="dark"] .sidebar-logo-area {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar-logo {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 2px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      .sidebar-subtitle {
        font-size: 9px;
        opacity: 0.7;
      }

      .sidebar-menu-section {
        margin-bottom: 5px;
      }

      .sidebar-section-header {
        padding: 8px 10px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.6);
        margin-bottom: 3px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        font-size: 13px;
      }

      [data-theme="dark"] .sidebar-section-header {
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar-section-header:hover {
        background: rgba(255, 255, 255, 0.8);
      }

      [data-theme="dark"] .sidebar-section-header:hover {
        background: rgba(30, 41, 59, 0.8);
      }

      .sidebar-section-header.active {
        background: var(--menu-active-bg);
        color: var(--menu-active-text);
      }

      .sidebar-section-icon {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .sidebar-section-arrow {
        transition: transform 0.3s ease;
        font-size: 10px;
      }

      .sidebar-section-header.active .sidebar-section-arrow {
        transform: rotate(180deg);
      }

      .sidebar-section-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        padding-left: 6px;
      }

      .sidebar-section-header.active + .sidebar-section-content {
        max-height: 500px;
      }

      .sidebar-menu-item {
        padding: 6px 8px 6px 24px;
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 5px;
        margin-top: 2px;
        display: flex;
        align-items: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.2);
        font-size: 12px;
      }

      [data-theme="dark"] .sidebar-menu-item {
        background: rgba(30, 41, 59, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar-menu-item:hover {
        background: rgba(255, 255, 255, 0.7);
      }

      [data-theme="dark"] .sidebar-menu-item:hover {
        background: rgba(30, 41, 59, 0.7);
      }

      .sidebar-menu-item.active {
        background: var(--menu-active-bg);
        color: var(--menu-active-text);
      }

      .sidebar-menu-icon {
        width: 12px;
        text-align: center;
        font-size: 10px;
      }

      /* Form layout */
      .form-rows {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
      }

      .category-form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .form-group {
        margin-bottom: 0;
      }

      .form-label {
        display: block;
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-bottom: 0.4rem;
        font-weight: 500;
      }

      /* Override Tailwind classes */
      .bg-white {
        background-color: var(--bg-secondary) !important;
      }

      .bg-gray-100 {
        background-color: var(--bg-tertiary) !important;
      }

      .text-gray-700,
      .text-gray-800,
      .text-gray-900 {
        color: var(--text-primary) !important;
      }

      .text-gray-600,
      .text-gray-500 {
        color: var(--text-secondary) !important;
      }

      .border,
      .border-gray-300 {
        border-color: var(--border-color) !important;
      }

      .shadow,
      .shadow-md,
      .shadow-lg {
        box-shadow:
          0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06) !important;
      }

      /* Theme toggle button */
      .theme-toggle {
        background: var(--accent-color);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .theme-toggle:hover {
        background: var(--text-muted);
      }

      /* Excel Upload button */
      .excel-upload {
        background: var(--accent-color);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        padding: 0.6rem 1.2rem;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .excel-upload:hover {
        background: var(--text-muted);
      }

      .excel-upload input[type="file"] {
        display: none;
      }

      /* Manpower section headers */
      .manpower-section-header {
        background: var(--bg-tertiary);
        padding: 0.7rem 1rem;
        font-weight: 600;
        border-bottom: 1px solid var(--border-color);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--text-primary);
      }

      /* Cable form wider inputs */
      .cable-form-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.1rem;
      }

      /* Manpower table select styles */
      .manpower-select {
        width: 100%;
        padding: 0.4rem;
        background: var(--select-bg);
        border: 1px solid var(--input-border);
        border-radius: 4px;
        font-size: 0.75rem;
        color: var(--select-text);
      }

      /* Subcategory select width  */
      .subcategory-select {
        width: 100%;
      }

      /* Detail select width   */
      .detail-select {
        width: 100%;
      }

      /* Elektrik ve Enstruman Detail selector  */
      .ei-detail-selector {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      /* Kablo Baƒülantƒ±larƒ± form d√ºzenlemeleri */
      .termination-first-row {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 1rem;
      }

      .termination-second-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .termination-from-to {
        min-width: 280px;
      }

      /* Date picker i√ßin g√∂r√ºn√ºr takvim simgesi */
      input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(0.5);
        cursor: pointer;
      }

      [data-theme="dark"]
        input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(0.8);
      }

      /* Foreman/Supervizor iki satƒ±r  */
      .foreman-position-two-line {
        line-height: 1.2;
        white-space: normal;
        word-break: break-word;
        font-size: 0.75rem;
      }

      /* Saat inputu i√ßin dar stil */
      .hours-input {
        width: 60px;
        min-width: 60px;
      }

      /* MANPOWER TABLO CONTAINER  */
      .manpower-table-container {
        width: 100%;
        overflow-x: auto;
        border: 1px solid var(--border-color);
        border-radius: 6px;
      }

      .manpower-table-container table {
        table-layout: fixed;
        width: 100%;
        margin: 0;
      }

      .manpower-table-container th:nth-child(1) {
        width: 5%;
      }
      .manpower-table-container th:nth-child(2) {
        width: 10%;
      }
      .manpower-table-container th:nth-child(3) {
        width: 20%;
      }
      .manpower-table-container th:nth-child(4) {
        width: 15%;
      }
      .manpower-table-container th:nth-child(5) {
        width: 40%;
      }
      .manpower-table-container th:nth-child(6) {
        width: 10%;
      }

      .manpower-table-container td {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: middle;
      }

      .manpower-table-container th {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* Isƒ±tma Sistemleri Cihaz Montajƒ± Formu i√ßin √∂zel stiller */
      .heating-device-form-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      /* 3'l√º se√ßim kutusu d√ºzeni */
      .heater-select-row {
        display: grid;
        grid-template-columns: 3fr 4.5fr 2.5fr; /* 30% 45% 25% */
        gap: 1rem;
      }

      .device-select {
        width: 100%;
      }

      .unit-inputs-row {
        display: grid;
        grid-template-columns: 0.5fr 0.5fr 1fr 1fr;
        gap: 1rem;
        align-items: end;
      }

      .unit-input {
        width: 100%;
      }

      .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
      }

      .compact-action-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
      }

      .compact-button {
        padding: 0.2rem 0.4rem;
        font-size: 0.65rem;
        min-height: auto;
      }

      .total-section {
        margin-top: 1rem;
        padding: 1rem;
        background: var(--bg-tertiary);
        border-radius: 6px;
        border: 1px solid var(--border-color);
      }

      .save-button {
        margin-top: 1rem;
        display: flex;
        justify-content: flex-end;
      }

      .disabled-button {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Pasif input i√ßin √∂zel stil */
      .form-input:disabled,
      .form-select:disabled {
        background-color: #f0f0f0;
        color: #a0a0a0;
        cursor: not-allowed;
      }

      [data-theme="dark"] .form-input:disabled,
      [data-theme="dark"] .form-select:disabled {
        background-color: #2a2a2a;
        color: #666;
      }

      /* Read-only input stilleri */
      .form-input:read-only {
        background-color: #f5f5f5;
        color: #6b7280;
        cursor: not-allowed;
      }

      [data-theme="dark"] .form-input:read-only {
        background-color: #2a2a2a;
        color: #9ca3af;
      }

      .form-select:disabled {
        background-color: #f5f5f5;
        color: #6b7280;
        cursor: not-allowed;
      }

      [data-theme="dark"] .form-select:disabled {
        background-color: #2a2a2a;
        color: #9ca3af;
      }

      /* Heating device table i√ßin optimize edilmi≈ü stiller */
      .heating-device-table th:nth-child(1) {
        width: 40%;
      } /* Isƒ±tƒ±cƒ± Adƒ± */
      .heating-device-table th:nth-child(2) {
        width: 12%;
      } /* Isƒ±tƒ±cƒ± G√ºc√º */
      .heating-device-table th:nth-child(3) {
        width: 10%;
      } /* En √áok Hava Miktarƒ± (m3/h) */
      .heating-device-table th:nth-child(4) {
        width: 8%;
      } /* Adet */
      .heating-device-table th:nth-child(5) {
        width: 10%;
      } /* ƒ∞≈ülem */

      .heating-device-table th:nth-child(3) {
        white-space: normal;
        line-height: 1.1;
        word-break: break-word;
      }

      .heating-device-table td:nth-child(1) {
        white-space: normal;
        line-height: 1.3;
      }

      .heating-device-table td:nth-child(2) {
        white-space: normal;
        line-height: 1.3;
        word-break: break-word;
      }
      /* Suggestions dropdown (custom under-input dropdown used for datalist replacement) */
      .suggestions-list {
        position: absolute;
        left: 0;
        right: 0;
        top: calc(100% + 6px);
        background: var(--select-bg);
        color: var(--select-text);
        border: 1px solid var(--input-border);
        border-radius: 4px;
        z-index: 60;
        max-height: 200px;
        overflow: auto;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
      }

      .suggestion-item {
        padding: 0.5rem;
        cursor: pointer;
        font-size: 0.85rem;
      }

      .suggestion-item:hover {
        background: var(--table-row-hover);
      }
    </style>
  </head>

  <body data-theme="light">
    <div id="root"></div>

    <script type="text/babel">
      // STƒ∞L SABƒ∞TLERƒ∞
      const buttonStyles = {
        primary: "btn btn-primary",
        secondary: "btn btn-secondary",
        success: "btn btn-success",
        danger: "btn btn-danger",
        edit: "btn btn-edit",
        small: "btn btn-primary btn-small",
        disabled:
          "btn bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed",
      };

      const inputStyles = "form-input";
      const selectStyles = "form-select";
      const tableHeaderStyles = "bg-gray-100 border px-2 py-1";
      const tableCellStyles = "border p-1";

      const menuStructure = [
        {
          name: "Raporlar",
          subs: [
            "Rapor Giri≈ü",
            "√áalƒ±≈üan Saha Raporu",
            "Saha Ekipman Raporu",
            "T√ºm Raporlar",
          ],
        },
        { name: "Projeler", subs: ["MT2-ST1", "MT2-ST2", "MT2-ST3"] },
        { name: "D√∂k√ºmanlar", subs: ["MT3-ST1", "MT3-ST2", "MT3-ST3"] },
        {
          name: "Malzeme",
          subs: ["Malzeme Talebi", "Stok Durumu", "Malzeme ƒ∞ade"],
        },
        {
          name: "Kalite Kontrol",
          subs: [
            "ƒ∞malat Kontrol Talebi (RFI)",
            "Uygunsuzluk Raporlarƒ± (NCR) ",
            "MT5-ST3",
          ],
        },
        {
          name: "Fotoƒüraflar",
          subs: ["Saha fotoƒüraflarƒ±", "MT6-ST2", "MT6-ST3"],
        },
        { name: "Hakedi≈üler", subs: ["MT7-ST1", "MT7-ST2", "MT7-ST3"] },
        { name: "MT8", subs: ["MT8-ST1", "MT8-ST2", "MT8-ST3"] },
        { name: "MT9", subs: ["MT9-ST1", "MT9-ST2", "MT9-ST3"] },
        { name: "MT10", subs: ["MT10-ST1", "MT10-ST2", "MT10-ST3"] },
      ];

      // Proje se√ßenekleri
      const projects = [
        { id: "proje-1", name: "Proje-1", active: true },
        { id: "proje-2", name: "Proje-2", active: false },
        { id: "proje-3", name: "Proje-3", active: false },
      ];

      // Alt y√ºklenici veritabanƒ±
      const subcontractors = {
        "SC-01": { name: "ABC ƒ∞n≈üaat Ltd.", password: "SC-01" },
        "SC-02": { name: "XYZ M√ºhendislik A.≈û.", password: "SC-02" },
        "SC-03": { name: "DEF Teknik Hizmetler", password: "SC-03" },
      };

      // Dil se√ßenekleri
      const languages = [
        { code: "TR", label: "TR - T√ºrk√ße" },
        { code: "EN", label: "EN - English" },
        { code: "RU", label: "RU - –†—É—Å—Å–∫–∏–π" },
      ];

      // Manpower tablo ba≈ülƒ±klarƒ± - MERKEZƒ∞ TANIM
      const manpowerTableHeaders = [
        "Se√ß",
        "Personal ID",
        "Ad Soyad",
        "Pozisyon",
        "ƒ∞≈ü Kategorisi",
        "Saat",
      ];

      // Shift se√ßenekleri
      const shifts = [
        { value: "", label: "Se√ßiniz" },
        { value: "day", label: "‚òÄÔ∏è G√ºnd√ºz Vardiyasƒ±" },
        { value: "night", label: "üåô Gece Vardiyasƒ±" },
      ];

      // Mechanical alt kategorileri
      const mechanicalSubCategories = {
        "Sƒ±hhi Tesisat": [
          "Vitrifiye ve Armat√ºr montajƒ±",
          "Borulama Tesisatƒ± ve Elemanlarƒ±",
          "Ekipman montajƒ±",
        ],
        // 'Radyat√∂r Demo' (yeni isim) i√ßeriƒüi eski 'Isƒ±tma Sistemleri Tesisatƒ±' ile aynƒ±dƒ±r
        "Radyat√∂r Demo": [
          "Isƒ±tƒ±cƒ± Montajƒ±",
          "Borulama Tesisatƒ± ve Elemanlarƒ±",
          "Ekipman montajƒ±",
        ],
        // 'IST' ve 'Doƒüalgaz Tesisatƒ±' i√ßerikleri 'Soƒüutma Tesisatƒ±' ile birebir aynƒ±dƒ±r
        "Soƒüutma Tesisatƒ±": [
          "Cihaz montajƒ±",
          "Borulama Tesisatƒ± ve Elemanlarƒ±",
          "Ekipman montajƒ±",
        ],
        "Isƒ±tma Sistemleri Tesisatƒ±": [
          "Isƒ±tƒ±cƒ± montajƒ±",
          "Borulama Tesisatƒ± ve Elemanlarƒ±",
          "Ekipman montajƒ±",
        ],
        "Havalandƒ±rma ve Klima Tesisatƒ±": [
          "Cihaz montajƒ±",
          "Kanal Montajƒ±",
          "Borulama Tesisatƒ± ve Elemanlarƒ±",
          "Ekipman montajƒ±",
        ],
        "Yangƒ±n Tesisatƒ±": [
          "Cihaz montajƒ±",
          "Borulama Tesisatƒ± ve Elemanlarƒ±",
          "Ekipman montajƒ±",
        ],
        "Doƒüalgaz Tesisatƒ±": [
          "Cihaz montajƒ±",
          "Borulama Tesisatƒ± ve Elemanlarƒ±",
          "Ekipman montajƒ±",
        ],
      };

      // Elektrik ve Enstruman Detay se√ßenekleri
      const eiDetailOptions = {
        "Kablo Kanalƒ± (Tavasƒ±) Montajƒ±": {
          detail1: ["Elektrik", "Enstr√ºman", "Telekom"],
          detail2: ["Ana (Birincil)", "ƒ∞kincil"],
        },
        "Kablo √áekimi": {
          detail1: ["Elektrik", "Enstr√ºman", "Telekom"],
        },
        "Kablo Baƒülantƒ±larƒ±": {
          detail1: ["Elektrik", "Enstr√ºman", "Telekom"],
        },
      };

      // Kategori veritabanƒ±
      const initialCategories = {
        mainCategories: [
          "ƒ∞n≈üaat",
          "Boru ve Kaynak",
          "Mekanik",
          "√áelik Yapƒ±lar",
          "Elektrik ve Enstruman",
          "Test ve Devreye Alma",
          "Laboratuvar",
        ],
        subCategories: {
          ƒ∞n≈üaat: ["Ekstra ƒ∞≈üler"],
          "Boru ve Kaynak": ["Ekstra ƒ∞≈üler"],
          Mekanik: [
            "Sƒ±hhi Tesisat",
            "Isƒ±tma Sistemleri Tesisatƒ±",
            "Soƒüutma Tesisatƒ±",
            "Havalandƒ±rma ve Klima Tesisatƒ±",
            "Yangƒ±n Tesisatƒ±",
            "Doƒüalgaz Tesisatƒ±",
            "Ekstra ƒ∞≈üler",
            "Radyat√∂r Demo",
          ],
          "√áelik Yapƒ±lar": ["Ekstra ƒ∞≈üler"],
          "Elektrik ve Enstruman": [
            "ƒ∞n≈üaat ƒ∞≈üleri",
            "Topraklama / Yƒ±ldƒ±rƒ±mdan Korunma",
            "Kablo Kanalƒ± (Tavasƒ±) Montajƒ±",
            "Kablo √áekimi",
            "Kablo Baƒülantƒ±larƒ±",
            "Elektrik Aksesuarlarƒ± ve Aydƒ±nlatma",
            "Elektrik Ekipmanlarƒ± - Pano",
            "Katodik Koruma",
            "Elektrikli Isƒ± Takip Sistemi",
            "Enstr√ºmanlar / Klemens Kutusu / Lokal Kontrol Panosu",
            "Pn√∂matik Sistemler ‚Äì Borulama",
            "Diƒüer Enstruman √ñƒüeleri - Vana - Flan≈ü - Manifold",
            "Kapalƒ± Devte Televizyon Sistemi (CCTV)",
            "Telekom Ekipmanlarƒ± ‚Äì Kabinet",
            "Ekstra ƒ∞≈üler",
          ],
          "Test ve Devreye Alma": ["Ekstra ƒ∞≈üler"],
          Laboratuvar: ["Ekstra ƒ∞≈üler"],
        },
      };

      // Yeni Isƒ±tƒ±cƒ± Veri Tabanƒ±
      const heaterData = {
        "Panel Radyat√∂r": {
          types: {
            "P (Tip 10)": { sizes: ["500 mm", "600 mm", "900 mm"] },
            "PK (Tip 11)": { sizes: ["500 mm", "600 mm", "900 mm"] },
            "PKP (Tip 21)": { sizes: ["500 mm", "600 mm", "900 mm"] },
            "PKKP (Tip 22)": { sizes: ["500 mm", "600 mm", "900 mm"] },
            "PKKKP (Tip 33)": { sizes: ["500 mm", "600 mm", "900 mm"] },
          },
        },
        "Banyo Tipi Havlupan": {
          types: {
            Al√ºminyum: {
              sizes: [
                "400-500, 1000 mm",
                "400-500, 1100 mm",
                "400-500, 1250 mm",
                "400-500, 1500 mm",
              ],
            },
            "√áelik-Beyaz boyalƒ±": {
              sizes: [
                "500, 700 mm",
                "500, 800 mm",
                "500, 900 mm",
                "500, 1000 mm",
              ],
            },
            "√áelik-Krom Kaplƒ±": {
              sizes: [
                "500, 700 mm",
                "500, 800 mm",
                "500, 900 mm",
                "500, 1000 mm",
              ],
            },
          },
        },
        "D√∂kme Dilim Radyat√∂r": {
          types: {
            "D√ºz satƒ±hlƒ± A serisi": {
              sizes: ["160/900 mm", "110/500 mm", "160/500 mm"],
            },
            "D√ºz satƒ±hlƒ± B serisi": {
              sizes: ["160/900 mm", "110/500 mm", "160/500 mm"],
            },
            "Kolonlu Tip": {
              sizes: ["144/650 mm", "221/650 mm", "144/500 mm"],
            },
            "D√ºzlem G√∂r√ºn√ºml√º": {
              sizes: ["99/623 mm", "134/623 mm", "99/500 mm"],
            },
          },
        },
        "Panel Tipi Al√ºminyum Radyat√∂r": {
          types: {
            "Geni≈üliƒüi 40 mm, Kalƒ±nlƒ±ƒüƒ± 60,70 mm aralƒ±ƒüƒ±nda": {
              sizes: [
                "600 mm",
                "750 mm",
                "825 mm",
                "900 mm",
                "1000 mm",
                "1250 mm",
              ],
            },
            "Geni≈üliƒüi 80 mm, Kalƒ±nlƒ±ƒüƒ± 30-40 mm aralƒ±ƒüƒ±nda": {
              sizes: [
                "600 mm",
                "750 mm",
                "825 mm",
                "900 mm",
                "1000 mm",
                "1250 mm",
              ],
            },
            "Geni≈üliƒüi 80 mm, Kalƒ±nlƒ±ƒüƒ± 60-70 mm aralƒ±ƒüƒ±nda": {
              sizes: [
                "600 mm",
                "750 mm",
                "825 mm",
                "900 mm",
                "1000 mm",
                "1250 mm",
              ],
            },
            "Geni≈üliƒüi 80 mm, Kalƒ±nlƒ±ƒüƒ± 100-110 mm aralƒ±ƒüƒ±nda": {
              sizes: [
                "600 mm",
                "750 mm",
                "825 mm",
                "900 mm",
                "1000 mm",
                "1250 mm",
              ],
            },
          },
        },
      };

      // Yeni Radyant Isƒ±tƒ±cƒ± veri yapƒ±sƒ±
      const radiantHeaterData = {
        "√úniter Radyant Isƒ±tƒ±cƒ±": {
          types: {
            "D√ºz Tip Borulu": { powers: ["15 kW", "20 kW", "30 kW", "55 kW"] },
            "U Tip Borulu": { powers: ["15 kW", "20 kW", "30 kW", "55 kW"] },
          },
        },
        "Seramik Radyant Isƒ±tƒ±cƒ±": {
          types: {
            "Gaz Yakƒ±tlƒ±": { powers: ["15 kW", "20 kW", "30 kW", "55 kW"] },
          },
        },
      };

      // Yeni Sƒ±cak Hava √úreteci ve Cihazƒ± veri yapƒ±sƒ±
      const hotAirDeviceData = {
        "Sƒ±cak Hava √úreteci": {
          types: {
            "Borulu E≈üanj√∂rl√º": {
              powers: ["15 kW", "20 kW", "30 kW", "55 kW"],
            },
            "Plakalƒ± E≈üanj√∂rl√º": {
              powers: ["15 kW", "20 kW", "30 kW", "55 kW"],
            },
          },
        },
        "Sƒ±cak Hava Cihazƒ±": {
          types: {
            "Radyal vantilat√∂rl√º": {
              powers: [
                "6.000 kcal/h",
                "8.000 kcal/h",
                "10.000 kcal/h",
                "12.000 kcal/h",
              ],
              airFlows: {
                "6.000 kcal/h": "1.300",
                "8.000 kcal/h": "1.500",
                "10.000 kcal/h": "1.500",
                "12.000 kcal/h": "2.500",
              },
            },
            "Aksiyal vantilat√∂rl√º": {
              powers: [
                "6.000 kcal/h",
                "8.000 kcal/h",
                "10.000 kcal/h",
                "12.000 kcal/h",
              ],
              airFlows: {
                "6.000 kcal/h": "900",
                "8.000 kcal/h": "1.100",
                "10.000 kcal/h": "1.200",
                "12.000 kcal/h": "1.600",
              },
            },
          },
        },
      };

      // √áalƒ±≈üma kategorileri (Ana Kategori + Alt Kategori)
      const getWorkCategories = () => {
        const categories = [];
        initialCategories.mainCategories.forEach((mainCat) => {
          if (initialCategories.subCategories[mainCat]) {
            initialCategories.subCategories[mainCat].forEach((subCat) => {
              categories.push(`${mainCat} - ${subCat}`);
            });
          }
        });
        return categories;
      };

      // Excel Dosya Y√ºkleme Bile≈üeni
      function ExcelUploadButton({ onExcelDataLoaded }) {
        const [fileName, setFileName] = React.useState("");

        const handleFileUpload = (event) => {
          const file = event.target.files[0];
          if (file) {
            setFileName(file.name);

            const reader = new FileReader();
            reader.onload = function (e) {
              try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: "array" });

                // T√ºm sayfalarƒ± oku
                const excelData = {};
                workbook.SheetNames.forEach((sheetName) => {
                  const worksheet = workbook.Sheets[sheetName];
                  const jsonData = XLSX.utils.sheet_to_json(worksheet, {
                    header: 1,
                  });
                  excelData[sheetName] = jsonData;
                });

                onExcelDataLoaded(excelData);
                alert(`Excel dosyasƒ± ba≈üarƒ±yla y√ºklendi: ${file.name}`);
              } catch (error) {
                console.error("Excel okuma hatasƒ±:", error);
                alert("Excel dosyasƒ± okunurken hata olu≈ütu: " + error.message);
              }
            };
            reader.readAsArrayBuffer(file);
          }
        };

        const triggerFileInput = () => {
          document.getElementById("excel-file-input").click();
        };

        return (
          <div className="excel-upload">
            <input
              type="file"
              id="excel-file-input"
              accept=".xlsx, .xls"
              onChange={handleFileUpload}
            />
            <button onClick={triggerFileInput}>üìä Excel Y√ºkle</button>
            {fileName && <span className="text-sm ml-2">({fileName})</span>}
          </div>
        );
      }

      // Tema deƒüi≈ütirici bile≈üeni
      function ThemeToggle() {
        const [isDark, setIsDark] = React.useState(false);

        const toggleTheme = () => {
          const newTheme = isDark ? "light" : "dark";
          document.body.setAttribute("data-theme", newTheme);
          setIsDark(!isDark);
        };

        return (
          <button
            className="theme-toggle"
            onClick={toggleTheme}
            title={isDark ? "A√ßƒ±k tema" : "Koyu tema"}
          >
            {isDark ? "‚òÄÔ∏è" : "üåô"}
          </button>
        );
      }

      // Dil se√ßici bile≈üeni
      function LanguageSelector() {
        const [selectedLang, setSelectedLang] = React.useState("TR");
        const [open, setOpen] = React.useState(false);

        return (
          <div className="relative inline-block text-left">
            <button
              type="button"
              onClick={() => setOpen(!open)}
              className="inline-flex items-center gap-1 px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              <span className="select-none">üåê</span>
              <span className="select-none">{selectedLang}</span>
              <svg
                className="w-4 h-4 text-gray-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>

            {open && (
              <div
                role="listbox"
                className="absolute right-0 mt-2 w-40 bg-white border border-gray-200 rounded-lg shadow-lg z-50"
              >
                {languages.map((lang) => (
                  <button
                    key={lang.code}
                    onClick={() => {
                      setSelectedLang(lang.code);
                      setOpen(false);
                    }}
                    className="block w-full text-left px-3 py-2 text-sm hover:bg-gray-100 whitespace-nowrap"
                  >
                    {lang.label}
                  </button>
                ))}
              </div>
            )}
          </div>
        );
      }

      // Proje Se√ßici Bile≈üeni
      function ProjectSelector({ onProjectSelect }) {
        const [selectedProject, setSelectedProject] = React.useState("");

        const handleProjectSelect = (projectId) => {
          setSelectedProject(projectId);
          onProjectSelect(projectId);
        };

        return (
          <div className="min-h-screen flex items-center justify-center bg-gray-100">
            <div className="max-w-md w-full bg-white rounded-lg shadow-md p-6">
              <div className="text-center mb-8">
                <h1 className="text-2xl font-bold text-gray-800">
                  Proje Se√ßimi
                </h1>
                <p className="text-gray-600 mt-2">
                  L√ºtfen √ßalƒ±≈ümak istediƒüiniz projeyi se√ßiniz
                </p>
              </div>

              <div className="space-y-4">
                {projects.map((project) => (
                  <button
                    key={project.id}
                    onClick={() => handleProjectSelect(project.id)}
                    disabled={!project.active}
                    className={`w-full text-left p-4 border rounded-lg transition-all ${
                      project.active
                        ? "border-blue-300 hover:border-blue-500 hover:bg-blue-50"
                        : "border-gray-300 bg-gray-100 cursor-not-allowed"
                    }`}
                  >
                    <div className="flex justify-between items-center">
                      <span
                        className={`font-medium ${project.active ? "text-gray-800" : "text-gray-400"}`}
                      >
                        {project.name}
                      </span>
                      {!project.active && (
                        <span className="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded">
                          Yakƒ±nda
                        </span>
                      )}
                    </div>
                    {project.active && selectedProject === project.id && (
                      <div className="mt-2 text-sm text-blue-600">
                        ‚úì Se√ßildi
                      </div>
                    )}
                  </button>
                ))}
              </div>
            </div>
          </div>
        );
      }

      // Isƒ±tma Sistemleri Cihaz Montajƒ± Formu Bile≈üeni - G√úNCELLENMƒ∞≈û
      function HeatingDeviceForm({ mechanicalDetail2 }) {
        const [selectedHeater, setSelectedHeater] = React.useState("");
        const [selectedHeaterType, setSelectedHeaterType] = React.useState("");
        const [selectedHeaterSize, setSelectedHeaterSize] = React.useState("");

        const [unit1, setUnit1] = React.useState(""); // Geni≈ülik (mm) veya En √áok Hava Miktarƒ± (m3/h)
        const [unit2, setUnit2] = React.useState(""); // Adet veya Dilim Adedi
        const [montajYeri, setMontajYeri] = React.useState(""); // Montaj Yeri - Mahal

        const [deviceList, setDeviceList] = React.useState([]);
        const [errors, setErrors] = React.useState({});
        const [editingId, setEditingId] = React.useState(null);

        // Se√ßime g√∂re veri yapƒ±sƒ±nƒ± belirle
        const getCurrentHeaterData = () => {
          if (mechanicalDetail2 === "Radyat√∂r") {
            return heaterData;
          } else if (mechanicalDetail2 === "Radyant Isƒ±tƒ±cƒ±") {
            return radiantHeaterData;
          } else if (mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±") {
            return hotAirDeviceData;
          }
          return {};
        };

        const currentHeaterData = getCurrentHeaterData();

        const heaterTypes = React.useMemo(() => {
          return currentHeaterData[selectedHeater]?.types
            ? Object.keys(currentHeaterData[selectedHeater].types)
            : [];
        }, [selectedHeater, currentHeaterData]);

        const heaterSizes = React.useMemo(() => {
          if (
            mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±" &&
            selectedHeater === "Sƒ±cak Hava Cihazƒ±"
          ) {
            return (
              currentHeaterData[selectedHeater]?.types[selectedHeaterType]
                ?.powers || []
            );
          }
          return (
            currentHeaterData[selectedHeater]?.types[selectedHeaterType]
              ?.sizes ||
            currentHeaterData[selectedHeater]?.types[selectedHeaterType]
              ?.powers ||
            []
          );
        }, [
          selectedHeater,
          selectedHeaterType,
          currentHeaterData,
          mechanicalDetail2,
        ]);

        // Ko≈üullu Birim Satƒ±rƒ±
        const getUnit1Label = () => {
          if (mechanicalDetail2 === "Radyat√∂r") {
            if (
              selectedHeater === "Panel Radyat√∂r" ||
              selectedHeater === "Panel Tipi Al√ºminyum Radyat√∂r"
            ) {
              return "Geni≈ülik (mm)";
            }
            return "-";
          } else if (mechanicalDetail2 === "Radyant Isƒ±tƒ±cƒ±") {
            return "-";
          } else if (mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±") {
            if (selectedHeater === "Sƒ±cak Hava Cihazƒ±") {
              return "En √áok Hava Miktarƒ± (m3/h)";
            }
            return "-";
          }
          return "-";
        };

        const getUnit1Disabled = () => {
          if (mechanicalDetail2 === "Radyat√∂r") {
            return (
              selectedHeater === "Banyo Tipi Havlupan" ||
              selectedHeater === "D√∂kme Dilim Radyat√∂r" ||
              !selectedHeater
            );
          } else if (mechanicalDetail2 === "Radyant Isƒ±tƒ±cƒ±") {
            return true;
          } else if (mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±") {
            return selectedHeater !== "Sƒ±cak Hava Cihazƒ±";
          }
          return true;
        };

        const getUnit1ReadOnly = () => {
          return (
            mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±" &&
            selectedHeater === "Sƒ±cak Hava Cihazƒ±"
          );
        };

        const unit1Label = getUnit1Label();
        const unit1Disabled = getUnit1Disabled();
        const unit1ReadOnly = getUnit1ReadOnly();

        const unit2Label =
          mechanicalDetail2 === "Radyat√∂r" &&
          selectedHeater === "D√∂kme Dilim Radyat√∂r"
            ? "Dilim Adedi"
            : "Adet";

        const unit1Props = React.useMemo(() => {
          if (mechanicalDetail2 === "Radyat√∂r") {
            if (selectedHeater === "Panel Radyat√∂r") {
              return { min: 400, max: 3000, step: 100 };
            }
            if (selectedHeater === "Panel Tipi Al√ºminyum Radyat√∂r") {
              if (
                selectedHeaterType ===
                "Geni≈üliƒüi 40 mm, Kalƒ±nlƒ±ƒüƒ± 60,70 mm aralƒ±ƒüƒ±nda"
              ) {
                return { min: 40, max: 3200, step: 40 };
              }
              return { min: 80, max: 3200, step: 80 };
            }
          } else if (mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±") {
            if (selectedHeater === "Sƒ±cak Hava Cihazƒ±") {
              return { min: 0, max: 10000, step: 1 };
            }
          }
          return {};
        }, [selectedHeater, selectedHeaterType, mechanicalDetail2]);

        // Se√ßimler deƒüi≈ütiƒüinde inputlarƒ± sƒ±fƒ±rla
        React.useEffect(() => {
          if (!editingId) {
            setUnit1("");
            setUnit2("");
            setMontajYeri("");
          }
          setErrors({});
        }, [
          selectedHeater,
          selectedHeaterType,
          selectedHeaterSize,
          editingId,
          mechanicalDetail2,
        ]);

        // Form doƒürulama
        const validateForm = () => {
          const newErrors = {};

          if (!selectedHeater) newErrors.heater = "Isƒ±tƒ±cƒ± se√ßilmelidir";
          if (!selectedHeaterType) newErrors.type = "Isƒ±tƒ±cƒ± tipi se√ßilmelidir";
          if (!selectedHeaterSize)
            newErrors.size = "Isƒ±tƒ±cƒ± √∂l√ß√ºs√º se√ßilmelidir";

          // Birim-1 (Geni≈ülik/Hava Miktarƒ±) doƒürulamasƒ±
          if (!unit1Disabled) {
            if (!unit1) {
              newErrors.unit1 = `${unit1Label} girilmelidir`;
            } else {
              const value = parseInt(unit1);
              const { min, max, step } = unit1Props;
              if (value < min || value > max) {
                newErrors.unit1 = `${unit1Label} ${min}-${max} arasƒ±nda olmalƒ±dƒ±r`;
              } else if (step && (value - min) % step !== 0) {
                newErrors.unit1 = `${unit1Label} ${step}'nin katlarƒ± olmalƒ±dƒ±r (${min}, ${min + step}...)`;
              }
            }
          }

          // Birim-2 (Adet/Dilim Adedi) doƒürulamasƒ±
          if (!unit2 || unit2 <= 0) {
            newErrors.unit2 = `Ge√ßerli bir ${unit2Label.toLowerCase()} giriniz`;
          } else if (unit2 > 100) {
            newErrors.unit2 = `${unit2Label} en fazla 100 olabilir`;
          }

          return newErrors;
        };

        // Ekle butonu i≈ülemi
        const handleAdd = () => {
          const validationErrors = validateForm();

          if (Object.keys(validationErrors).length > 0) {
            setErrors(validationErrors);
            return;
          }

          if (deviceList.length >= 15 && !editingId) {
            alert("Maksimum 15 adet ƒ±sƒ±tƒ±cƒ± ekleyebilirsiniz");
            return;
          }

          const newItem = {
            id: editingId || Date.now(),
            heater: selectedHeater,
            type: selectedHeaterType,
            size: selectedHeaterSize,
            width: unit1Disabled ? null : unit1,
            count: parseInt(unit2),
            montajYeri: montajYeri || "",
            detail2: mechanicalDetail2,
          };

          if (editingId) {
            setDeviceList(
              deviceList.map((item) =>
                item.id === editingId ? newItem : item,
              ),
            );
            setEditingId(null);
          } else {
            setDeviceList([...deviceList, newItem]);
          }

          // Formu sƒ±fƒ±rla
          setSelectedHeater("");
          setSelectedHeaterType("");
          setSelectedHeaterSize("");
          setUnit1("");
          setUnit2("");
          setMontajYeri("");
          setErrors({});
        };

        // Cihazƒ± listeden kaldƒ±r
        const handleRemove = (id) => {
          setDeviceList(deviceList.filter((item) => item.id !== id));
        };

        // Cihazƒ± d√ºzenlemeye al
        const handleEdit = (id) => {
          const item = deviceList.find((item) => item.id === id);
          if (item) {
            setSelectedHeater(item.heater);
            setSelectedHeaterType(item.type);
            setSelectedHeaterSize(item.size);
            setUnit1(item.width || "");
            setUnit2(item.count);
            setMontajYeri(item.montajYeri || "");
            setEditingId(id);
          }
        };

        // D√ºzenlemeyi iptal et
        const handleCancelEdit = () => {
          setSelectedHeater("");
          setSelectedHeaterType("");
          setSelectedHeaterSize("");
          setUnit1("");
          setUnit2("");
          setEditingId(null);
          setErrors({});
        };

        // RADYAT√ñR HESAPLAMA MANTIƒûI
        const calculateRadiatorMetrics = (item) => {
          let totalLength = null;
          let totalArea = null;
          const count = parseInt(item.count);

          if (item.heater === "Panel Radyat√∂r") {
            const width_m = parseFloat(item.width) / 1000;
            totalLength = width_m * count;
          }

          if (item.heater === "D√∂kme Dilim Radyat√∂r") {
            const parts = item.size.split(" ")[0].split("/");
            const val1_m = parseFloat(parts[0]) / 1000;
            const val2_m = parseFloat(parts[1]) / 1000;
            totalArea = val1_m * val2_m * count;
            totalArea = Math.ceil(totalArea * 100) / 100;
          }

          if (item.heater === "Panel Tipi Al√ºminyum Radyat√∂r") {
            const size_m = parseFloat(item.size.split(" ")[0]) / 1000;
            const width_m = parseFloat(item.width) / 1000;
            totalArea = size_m * width_m * count;
          }

          return { totalLength, totalArea, count };
        };

        // Dƒ∞ƒûER ISITICILAR HESAPLAMA MANTIƒûI
        const calculateOtherHeaterMetrics = (item) => {
          return { count: parseInt(item.count) };
        };

        // TOPLAM Mƒ∞KTARLARI HESAPLA - Bƒ∞RLE≈ûTƒ∞Rƒ∞LMƒ∞≈û
        const totals = React.useMemo(() => {
          const acc = {
            // Radyat√∂r toplamlarƒ±
            "Panel Radyat√∂r": { length: 0, count: 0 },
            "Banyo Tipi Havlupan": { count: 0 },
            "D√∂kme Dilim Radyat√∂r": { area: 0, slices: 0 },
            "Panel Tipi Al√ºminyum Radyat√∂r": { area: 0, count: 0 },
            // Diƒüer ƒ±sƒ±tƒ±cƒ± toplamlarƒ±
            otherHeaters: {},
          };

          deviceList.forEach((item) => {
            if (item.detail2 === "Radyat√∂r") {
              const metrics = calculateRadiatorMetrics(item);

              if (item.heater === "Panel Radyat√∂r") {
                acc["Panel Radyat√∂r"].length += metrics.totalLength;
                acc["Panel Radyat√∂r"].count += metrics.count;
              } else if (item.heater === "Banyo Tipi Havlupan") {
                acc["Banyo Tipi Havlupan"].count += metrics.count;
              } else if (item.heater === "D√∂kme Dilim Radyat√∂r") {
                acc["D√∂kme Dilim Radyat√∂r"].area += metrics.totalArea;
                acc["D√∂kme Dilim Radyat√∂r"].slices += metrics.count;
              } else if (item.heater === "Panel Tipi Al√ºminyum Radyat√∂r") {
                acc["Panel Tipi Al√ºminyum Radyat√∂r"].area += metrics.totalArea;
                acc["Panel Tipi Al√ºminyum Radyat√∂r"].count += metrics.count;
              }
            } else {
              // Diƒüer ƒ±sƒ±tƒ±cƒ±lar
              const metrics = calculateOtherHeaterMetrics(item);
              const key = `${item.type} ${item.heater} ${item.size}`;

              if (!acc.otherHeaters[key]) {
                acc.otherHeaters[key] = 0;
              }
              acc.otherHeaters[key] += metrics.count;
            }
          });

          return acc;
        }, [deviceList]);

        // Sƒ±cak Hava Cihazƒ± i√ßin hava miktarƒ±nƒ± getir
        const getAirFlowValue = () => {
          if (
            mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±" &&
            selectedHeater === "Sƒ±cak Hava Cihazƒ±" &&
            selectedHeaterType &&
            selectedHeaterSize
          ) {
            return (
              currentHeaterData[selectedHeater]?.types[selectedHeaterType]
                ?.airFlows?.[selectedHeaterSize] || ""
            );
          }
          return "";
        };

        // Se√ßim deƒüi≈ütiƒüinde hava miktarƒ±nƒ± otomatik doldur
        React.useEffect(() => {
          if (
            mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±" &&
            selectedHeater === "Sƒ±cak Hava Cihazƒ±" &&
            selectedHeaterType &&
            selectedHeaterSize &&
            !editingId
          ) {
            const airFlow = getAirFlowValue();
            if (airFlow) {
              setUnit1(airFlow);
            }
          }
        }, [
          selectedHeaterSize,
          mechanicalDetail2,
          selectedHeater,
          selectedHeaterType,
          editingId,
        ]);

        // Cihazlarƒ± t√ºrlerine g√∂re filtrele
        const radiatorDevices = deviceList.filter(
          (item) => item.detail2 === "Radyat√∂r",
        );
        const otherDevices = deviceList.filter(
          (item) => item.detail2 !== "Radyat√∂r",
        );

        return (
          <div className="heating-device-form-container">
            <div className="form-rows">
              {/* 3'l√º se√ßim satƒ±rƒ± */}
              <div className="heater-select-row">
                <div className="form-group">
                  <label className="form-label">Isƒ±tƒ±cƒ±</label>
                  <select
                    value={selectedHeater}
                    onChange={(e) => {
                      setSelectedHeater(e.target.value);
                      setSelectedHeaterType("");
                      setSelectedHeaterSize("");
                    }}
                    className={`${selectStyles} device-select`}
                  >
                    <option value="">Se√ßiniz</option>
                    {Object.keys(currentHeaterData).map((heater) => (
                      <option key={heater} value={heater}>
                        {heater}
                      </option>
                    ))}
                  </select>
                  {errors.heater && (
                    <div className="text-red-500 text-xs mt-1">
                      {errors.heater}
                    </div>
                  )}
                </div>
                <div className="form-group">
                  <label className="form-label">Isƒ±tƒ±cƒ± Tipi</label>
                  <select
                    value={selectedHeaterType}
                    onChange={(e) => {
                      setSelectedHeaterType(e.target.value);
                      setSelectedHeaterSize("");
                    }}
                    className={`${selectStyles} device-select`}
                    disabled={!selectedHeater}
                  >
                    <option value="">Se√ßiniz</option>
                    {heaterTypes.map((type) => (
                      <option key={type} value={type}>
                        {type}
                      </option>
                    ))}
                  </select>
                  {errors.type && (
                    <div className="text-red-500 text-xs mt-1">
                      {errors.type}
                    </div>
                  )}
                </div>
                <div className="form-group">
                  <label className="form-label">
                    {mechanicalDetail2 === "Radyant Isƒ±tƒ±cƒ±" ||
                    (mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±" &&
                      selectedHeater === "Sƒ±cak Hava √úreteci")
                      ? "Isƒ±tƒ±cƒ± G√ºc√º"
                      : mechanicalDetail2 === "Sƒ±cak Hava √úreteci ve Cihazƒ±" &&
                          selectedHeater === "Sƒ±cak Hava Cihazƒ±"
                        ? "Isƒ±tƒ±cƒ± G√ºc√º (kcal/h)"
                        : "Isƒ±tƒ±cƒ± √ñl√ß√ºs√º"}
                  </label>
                  <select
                    value={selectedHeaterSize}
                    onChange={(e) => setSelectedHeaterSize(e.target.value)}
                    className={`${selectStyles} device-select`}
                    disabled={!selectedHeaterType}
                  >
                    <option value="">Se√ßiniz</option>
                    {heaterSizes.map((size) => (
                      <option key={size} value={size}>
                        {size}
                      </option>
                    ))}
                  </select>
                  {errors.size && (
                    <div className="text-red-500 text-xs mt-1">
                      {errors.size}
                    </div>
                  )}
                </div>
              </div>

              {/* Ko≈üullu Birim Satƒ±rƒ± */}
              <div className="unit-inputs-row">
                <div className="form-group">
                  <label className="form-label">{unit1Label}</label>
                  <input
                    type="number"
                    value={unit1}
                    onChange={(e) => setUnit1(e.target.value)}
                    className={`${inputStyles} unit-input`}
                    disabled={unit1Disabled}
                    readOnly={unit1ReadOnly}
                    {...unit1Props}
                  />
                  {errors.unit1 && (
                    <div className="text-red-500 text-xs mt-1">
                      {errors.unit1}
                    </div>
                  )}
                </div>

                <div className="form-group">
                  <label className="form-label">{unit2Label}</label>
                  <input
                    type="number"
                    value={unit2}
                    onChange={(e) => {
                      let val = e.target.value;
                      if (val) {
                        val = parseInt(val);
                        if (val < 1) val = 1;
                        if (val > 100) val = 100;
                      }
                      setUnit2(val);
                    }}
                    className={`${inputStyles} unit-input`}
                    disabled={!selectedHeaterSize}
                    min="1"
                    max="100"
                    step="1"
                  />
                  {errors.unit2 && (
                    <div className="text-red-500 text-xs mt-1">
                      {errors.unit2}
                    </div>
                  )}
                </div>

                <div className="form-group">
                  <label className="form-label">Montaj Yeri-Mahal</label>
                  <input
                    type="text"
                    value={montajYeri}
                    onChange={(e) => setMontajYeri(e.target.value)}
                    className={`${inputStyles} unit-input`}
                    disabled={!selectedHeaterSize}
                    placeholder=" "
                  />
                </div>

                <div className="form-group">
                  <div className="flex space-x-2">
                    <button
                      onClick={handleAdd}
                      className={buttonStyles.success}
                      style={{ width: "100%" }}
                      disabled={!selectedHeaterSize}
                    >
                      {editingId ? "G√ºncelle" : "Ekle"} ({deviceList.length}/15)
                    </button>
                    {editingId && (
                      <button
                        onClick={handleCancelEdit}
                        className={buttonStyles.secondary}
                        style={{ width: "100%" }}
                      >
                        ƒ∞ptal
                      </button>
                    )}
                  </div>
                </div>
              </div>
            </div>

            {deviceList.length > 0 && (
              <>
                {/* KO≈ûULLU TABLO RENDER */}

                {/* RADYAT√ñR TABLOSU  */}
                {radiatorDevices.length > 0 && (
                  <div className="section">
                    <h3 className="section-title">
                      Eklenen Isƒ±tƒ±cƒ±lar - Radyat√∂r Tipi
                    </h3>
                    <div className="manpower-table-container">
                      <table className="data-table heating-device-table">
                        <thead>
                          <tr>
                            <th>Isƒ±tƒ±cƒ± Adƒ±</th>
                            <th>Isƒ±tƒ±cƒ± √ñl√ß√ºs√º</th>
                            <th>Geni≈ülik (mm)</th>
                            <th>Adet</th>
                            <th>Toplam Uzunluk (m)</th>
                            <th>Toplam Alan (m2)</th>
                            <th>ƒ∞≈ülem</th>
                          </tr>
                        </thead>
                        <tbody>
                          {radiatorDevices.map((item) => {
                            const metrics = calculateRadiatorMetrics(item);
                            return (
                              <tr key={item.id}>
                                <td>
                                  {item.type} {item.heater}
                                </td>
                                <td>{item.size}</td>
                                <td>{item.width || "-"}</td>
                                <td>{item.count}</td>
                                <td>
                                  {metrics.totalLength !== null
                                    ? metrics.totalLength.toFixed(2)
                                    : "-"}
                                </td>
                                <td>
                                  {metrics.totalArea !== null
                                    ? metrics.totalArea.toFixed(2)
                                    : "-"}
                                </td>
                                <td>
                                  <div className="compact-action-buttons">
                                    <button
                                      onClick={() => handleEdit(item.id)}
                                      className={`${buttonStyles.edit} ${buttonStyles.small} compact-button`}
                                    >
                                      D√ºzenle
                                    </button>
                                    <button
                                      onClick={() => handleRemove(item.id)}
                                      className={`${buttonStyles.danger} ${buttonStyles.small} compact-button`}
                                    >
                                      Sil
                                    </button>
                                  </div>
                                </td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {/* Dƒ∞ƒûER ISITICILAR TABLOSU  */}
                {otherDevices.length > 0 && (
                  <div className="section">
                    <h3 className="section-title">
                      Eklenen Isƒ±tƒ±cƒ±lar - Diƒüer Tip
                    </h3>
                    <div className="manpower-table-container">
                      <table className="data-table heating-device-table">
                        <thead>
                          <tr>
                            <th>Isƒ±tƒ±cƒ± Adƒ±</th>
                            <th>Isƒ±tƒ±cƒ± G√ºc√º</th>
                            <th>En √áok Hava Miktarƒ± (m3/h)</th>
                            <th>Adet</th>
                            <th>ƒ∞≈ülem</th>
                          </tr>
                        </thead>
                        <tbody>
                          {otherDevices.map((item) => {
                            const metrics = calculateOtherHeaterMetrics(item);
                            return (
                              <tr key={item.id}>
                                <td>
                                  {item.type} {item.heater}
                                </td>
                                <td>{item.size}</td>
                                <td>
                                  {mechanicalDetail2 ===
                                    "Sƒ±cak Hava √úreteci ve Cihazƒ±" &&
                                  item.heater === "Sƒ±cak Hava Cihazƒ±"
                                    ? `${item.width} m3/h`
                                    : "-"}
                                </td>
                                <td>{item.count}</td>
                                <td>
                                  <div className="compact-action-buttons">
                                    <button
                                      onClick={() => handleEdit(item.id)}
                                      className={`${buttonStyles.edit} ${buttonStyles.small} compact-button`}
                                    >
                                      D√ºzenle
                                    </button>
                                    <button
                                      onClick={() => handleRemove(item.id)}
                                      className={`${buttonStyles.danger} ${buttonStyles.small} compact-button`}
                                    >
                                      Sil
                                    </button>
                                  </div>
                                </td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {/* TEK TOPLAM B√ñL√úM√ú - Bƒ∞RLE≈ûTƒ∞Rƒ∞LMƒ∞≈û */}
                <div className="total-section">
                  <h4 className="section-title">Toplam Miktar</h4>

                  {/* RADYAT√ñR TOPLAMLARI */}
                  {totals["Panel Radyat√∂r"].count > 0 && (
                    <p>
                      <strong>Panel Radyat√∂r Toplam Uzunluk:</strong>{" "}
                      {totals["Panel Radyat√∂r"].length.toFixed(2)} metre ‚Äì{" "}
                      {totals["Panel Radyat√∂r"].count} Adet
                    </p>
                  )}

                  {totals["Banyo Tipi Havlupan"].count > 0 && (
                    <p>
                      <strong>Banyo Tipi Havlupan Toplam Adet:</strong>{" "}
                      {totals["Banyo Tipi Havlupan"].count} adet
                    </p>
                  )}

                  {totals["D√∂kme Dilim Radyat√∂r"].slices > 0 && (
                    <p>
                      <strong>D√∂kme Dilim Radyat√∂r Toplam Alan:</strong>{" "}
                      {totals["D√∂kme Dilim Radyat√∂r"].area.toFixed(2)} m2 ‚Äì{" "}
                      {totals["D√∂kme Dilim Radyat√∂r"].slices} Dilim
                    </p>
                  )}

                  {totals["Panel Tipi Al√ºminyum Radyat√∂r"].count > 0 && (
                    <p>
                      <strong>
                        Panel Tipi Al√ºminyum Radyat√∂r Toplam Alan:
                      </strong>{" "}
                      {totals["Panel Tipi Al√ºminyum Radyat√∂r"].area.toFixed(2)}{" "}
                      m2 ‚Äì {totals["Panel Tipi Al√ºminyum Radyat√∂r"].count} Adet
                    </p>
                  )}

                  {/* Dƒ∞ƒûER ISITICI TOPLAMLARI */}
                  {Object.keys(totals.otherHeaters).map(
                    (key) =>
                      totals.otherHeaters[key] > 0 && (
                        <p key={key}>
                          <strong>{key} Toplam:</strong>{" "}
                          {totals.otherHeaters[key]} Adet
                        </p>
                      ),
                  )}
                </div>

                <div className="save-button">
                  <button
                    className={`${buttonStyles.primary} disabled-button`}
                    disabled
                  >
                    Kaydet
                  </button>
                </div>
              </>
            )}
          </div>
        );
      }
// Mekanik Rapor Formu Bile≈üeni
function MechanicalReportForm({ mainCategory, subCategory, mechanicalDetail, mechanicalDetail2, excelData }) {
  const [montajYeri, setMontajYeri] = React.useState("");
  const [katBilgisi, setKatBilgisi] = React.useState("");
  const [yapilacakIsTanimi, setYapilacakIsTanimi] = React.useState("");
  const [toplamMiktar, setToplamMiktar] = React.useState("");
  const [montajMiktari, setMontajMiktari] = React.useState("");
  const [kalanMiktar, setKalanMiktar] = React.useState("");
  const [miktar, setMiktar] = React.useState("");
  const [olcu, setOlcu] = React.useState("");
  const [birim, setBirim] = React.useState("");
  const [kapasite, setKapasite] = React.useState("");

  // Yeni state'ler
  const [workList, setWorkList] = React.useState([]);
  const [editingId, setEditingId] = React.useState(null);
  const [errors, setErrors] = React.useState({});

  // Ana Kategori, Alt Kategori, Detay-1, Detay-2 deƒüi≈ütiƒüinde formu sƒ±fƒ±rla
  React.useEffect(() => {
    setMontajYeri("");
    setKatBilgisi("");
    setYapilacakIsTanimi("");
    setToplamMiktar("");
    setMontajMiktari("");
    setKalanMiktar("");
    setBirim("");
    setKapasite("");
    setOlcu("");
    setMiktar("");
    setWorkList([]);
    setEditingId(null);
  }, [mainCategory, subCategory, mechanicalDetail, mechanicalDetail2]);
  
  const [showMontajYeriSuggestions, setShowMontajYeriSuggestions] = React.useState(false);
  const [showYapilacakIsSuggestions, setShowYapilacakIsSuggestions] = React.useState(false);
  
  // Montaj Yeri-Mahal i√ßin Excel verilerini al
  const getMontajYeriOptions = () => {
    if (!excelData || !excelData["Mekanik"]) return [];

    const sheetData = excelData["Mekanik"];
    if (sheetData.length < 2) return [];

    // Ba≈ülƒ±klarƒ± bul
    const headers = sheetData[0];
    const categoryIndex = headers.indexOf("Category");
    const subcategoryIndex = headers.indexOf("Subcategory");
    const detail1Index = headers.indexOf("Detail_1");
    const detail2Index = headers.indexOf("Detail_2");
    const locationIndex = headers.indexOf("Location");

    // Ge√ßerli kategori ve alt kategoriye uygun satƒ±rlarƒ± filtrele
    const filteredRows = sheetData.filter((row, index) => {
      if (index === 0) return false; // Ba≈ülƒ±k satƒ±rƒ±nƒ± atla
      
      return row[categoryIndex] === mainCategory && 
             row[subcategoryIndex] === subCategory &&
             row[detail1Index] === mechanicalDetail &&
             row[detail2Index] === mechanicalDetail2;
    });

    // Location deƒüerlerini al ve tekrarlarƒ± kaldƒ±r
    const locationOptions = [...new Set(filteredRows
      .map(row => row[locationIndex])
      .filter(Boolean))]; // Bo≈ü olmayan deƒüerleri al

    return locationOptions;
  };

  const montajYeriOptions = getMontajYeriOptions();

  // Yapƒ±lacak i≈üin tanƒ±mƒ± i√ßin Excel verilerini al
  const getIsTanimiOptions = () => {
    if (!excelData || !excelData["Mekanik"] || !montajYeri) return [];

    const sheetData = excelData["Mekanik"];
    if (sheetData.length < 2) return [];

    // Ba≈ülƒ±klarƒ± bul
    const headers = sheetData[0];
    const categoryIndex = headers.indexOf("Category");
    const subcategoryIndex = headers.indexOf("Subcategory");
    const detail1Index = headers.indexOf("Detail_1");
    const detail2Index = headers.indexOf("Detail_2");
    const locationIndex = headers.indexOf("Location");
    const descriptionIndex = headers.indexOf("Description");

    // Ge√ßerli kategori, alt kategori ve montaj yerine uygun satƒ±rlarƒ± filtrele
    const filteredRows = sheetData.filter((row, index) => {
      if (index === 0) return false; // Ba≈ülƒ±k satƒ±rƒ±nƒ± atla
      
      return row[categoryIndex] === mainCategory && 
             row[subcategoryIndex] === subCategory &&
             row[detail1Index] === mechanicalDetail &&
             row[detail2Index] === mechanicalDetail2 &&
             row[locationIndex] === montajYeri;
    });

    // Description deƒüerlerini al ve tekrarlarƒ± kaldƒ±r
    const descriptionOptions = [...new Set(filteredRows
      .map(row => row[descriptionIndex])
      .filter(Boolean))]; // Bo≈ü olmayan deƒüerleri al

    return descriptionOptions;
  };

  const isTanimiOptions = getIsTanimiOptions();

  // Montaj yeri se√ßildiƒüinde kat bilgisini Excel'den al
  const handleMontajYeriSelect = (selectedYer) => {
    setMontajYeri(selectedYer);
    
    // Excel'den Floor bilgisini al
    if (!excelData || !excelData["Mekanik"]) {
      setKatBilgisi("");
      return;
    }

    const sheetData = excelData["Mekanik"];
    if (sheetData.length < 2) {
      setKatBilgisi("");
      return;
    }

    // Ba≈ülƒ±klarƒ± bul
    const headers = sheetData[0];
    const categoryIndex = headers.indexOf("Category");
    const subcategoryIndex = headers.indexOf("Subcategory");
    const detail1Index = headers.indexOf("Detail_1");
    const detail2Index = headers.indexOf("Detail_2");
    const locationIndex = headers.indexOf("Location");
    const floorIndex = headers.indexOf("Floor");

    // E≈üle≈üen satƒ±rƒ± bul
    const matchedRow = sheetData.find((row, index) => {
      if (index === 0) return false; // Ba≈ülƒ±k satƒ±rƒ±nƒ± atla
      
      return row[categoryIndex] === mainCategory && 
             row[subcategoryIndex] === subCategory &&
             row[detail1Index] === mechanicalDetail &&
             row[detail2Index] === mechanicalDetail2 &&
             row[locationIndex] === selectedYer;
    });

    // Floor bilgisini ayarla
    if (matchedRow && matchedRow[floorIndex]) {
      setKatBilgisi(matchedRow[floorIndex]);
    } else {
      setKatBilgisi("");
    }

    // Montaj yeri deƒüi≈ütiƒüinde i≈ü tanƒ±mƒ±nƒ± ve miktarlarƒ± sƒ±fƒ±rla
    setYapilacakIsTanimi("");
    setToplamMiktar("");
    setMontajMiktari("");
    setKalanMiktar("");
    setBirim("");
    setKapasite("");
    setOlcu("");
  };

  // Yapƒ±lacak i≈ü tanƒ±mƒ± se√ßildiƒüinde miktar bilgilerini Excel'den al
  const handleIsTanimiSelect = (selectedIsTanimi) => {
    setYapilacakIsTanimi(selectedIsTanimi);
    
    if (!excelData || !excelData["Mekanik"] || !montajYeri) {
      setToplamMiktar("");
      setMontajMiktari("");
      setKalanMiktar("");
      setBirim("");
      setKapasite("");
      setOlcu("");
      return;
    }

    const sheetData = excelData["Mekanik"];
    if (sheetData.length < 2) {
      setToplamMiktar("");
      setMontajMiktari("");
      setKalanMiktar("");
      setBirim("");
      setKapasite("");
      setOlcu("");
      return;
    }

    // Ba≈ülƒ±klarƒ± bul
    const headers = sheetData[0];
    const categoryIndex = headers.indexOf("Category");
    const subcategoryIndex = headers.indexOf("Subcategory");
    const detail1Index = headers.indexOf("Detail_1");
    const detail2Index = headers.indexOf("Detail_2");
    const locationIndex = headers.indexOf("Location");
    const descriptionIndex = headers.indexOf("Description");
    const totalIndex = headers.indexOf("Total");
    const installedIndex = headers.indexOf("Installed");
    const remainingIndex = headers.indexOf("Remaining");
    const unitIndex = headers.indexOf("Unit");
    const capacityIndex = headers.indexOf("Capacity");
    const sizeIndex = headers.indexOf("Size");

    // E≈üle≈üen satƒ±rƒ± bul
    const matchedRow = sheetData.find((row, index) => {
      if (index === 0) return false; // Ba≈ülƒ±k satƒ±rƒ±nƒ± atla
      
      return row[categoryIndex] === mainCategory && 
             row[subcategoryIndex] === subCategory &&
             row[detail1Index] === mechanicalDetail &&
             row[detail2Index] === mechanicalDetail2 &&
             row[locationIndex] === montajYeri &&
             row[descriptionIndex] === selectedIsTanimi;
    });

    // Miktar bilgilerini ayarla
    if (matchedRow) {
      setToplamMiktar(matchedRow[totalIndex] || "");
      setMontajMiktari(matchedRow[installedIndex] || "");
      setKalanMiktar(matchedRow[remainingIndex] || "");
      setBirim(matchedRow[unitIndex] || "");
      setKapasite(matchedRow[capacityIndex] || "");
      setOlcu(matchedRow[sizeIndex] || "");
    } else {
      setToplamMiktar("");
      setMontajMiktari("");
      setKalanMiktar("");
      setBirim("");
      setKapasite("");
      setOlcu("");
    }
  };

  // Raporlama Miktarƒ± i√ßin maksimum deƒüeri hesapla
  const getMaxMiktar = () => {
    const kalanMiktarNum = parseInt(kalanMiktar) || 0;
    const totalReported = workList.reduce((total, item) => {
      if (item.yapilacakIsTanimi === yapilacakIsTanimi && item.montajYeri === montajYeri) {
        return total + item.miktar;
      }
      return total;
    }, 0);
    return Math.max(0, kalanMiktarNum - totalReported);
  };

  // Raporlama Miktarƒ± deƒüi≈ütiƒüinde kontrol et
  const handleMiktarChange = (value) => {
    if (value === "") {
      setMiktar(value);
      return;
    }
    
    const numValue = parseInt(value);
    const maxMiktar = getMaxMiktar();
    
    if (!isNaN(numValue) && numValue >= 0 && numValue <= maxMiktar) {
      setMiktar(value);
    } else if (numValue > maxMiktar) {
      setMiktar(maxMiktar.toString());
    }
  };

  // Kapasite/√ñl√ß√º metnini olu≈ütur
  const getCapacityDisplay = (kapasite, olcu) => {
    if (kapasite && kapasite !== "-" && olcu && olcu !== "-") {
      return `${kapasite} - ${olcu}`;
    } else if (kapasite && kapasite !== "-") {
      return kapasite;
    } else if (olcu && olcu !== "-") {
      return olcu;
    }
    return "-";
  };

// ƒ∞≈ü ekle/g√ºncelle
const handleAdd = () => {
  // Validasyon
  const newErrors = {};
  if (!montajYeri) newErrors.montajYeri = "Montaj yeri giriniz";
  if (!yapilacakIsTanimi) newErrors.isTanimi = "Yapƒ±lacak i≈üi giriniz";
  if (!miktar || miktar <= 0) newErrors.miktar = "Miktar giriniz";

  if (Object.keys(newErrors).length > 0) {
    setErrors(newErrors);
    return;
  }
  
  setErrors({}); // Validasyon ba≈üarƒ±lƒ±, hatalarƒ± temizle

  const newWork = {
    id: editingId || Date.now(),
    yapilacakIsTanimi,
    kapasite: kapasite || "-",
    olcu: olcu || "-",
    montajYeri,
    miktar: parseInt(miktar),
    birim,
  };

  if (editingId) {
    setWorkList(workList.map(item => item.id === editingId ? newWork : item));
    setEditingId(null);
  } else {
    setWorkList([...workList, newWork]);
  }

  // Formu tamamen temizle
  setMontajYeri("");
  setKatBilgisi("");
  setYapilacakIsTanimi("");
  setToplamMiktar("");
  setMontajMiktari("");
  setKalanMiktar("");
  setBirim("");
  setKapasite("");
  setOlcu("");
  setMiktar("");
};

// ƒ∞≈ü d√ºzenle
  const handleEdit = (id) => {
    const work = workList.find(item => item.id === id);
    if (work) {
      // 1. Formu doldur
      setYapilacakIsTanimi(work.yapilacakIsTanimi);
      setKapasite(work.kapasite);
      setOlcu(work.olcu);
      setMontajYeri(work.montajYeri);
      setMiktar(work.miktar.toString());
      setBirim(work.birim);
      setEditingId(id);
      setErrors({}); // Hatalarƒ± temizle
      
      // 2. Excel'den 'Kat Bilgisi'ni yeniden y√ºkle (handleMontajYeriSelect'ten alƒ±nan mantƒ±k)
      if (excelData && excelData["Mekanik"]) {
        const sheetData = excelData["Mekanik"];
        if (sheetData.length >= 2) {
          const headers = sheetData[0];
          const categoryIndex = headers.indexOf("Category");
          const subcategoryIndex = headers.indexOf("Subcategory");
          const detail1Index = headers.indexOf("Detail_1");
          const detail2Index = headers.indexOf("Detail_2");
          const locationIndex = headers.indexOf("Location");
          const floorIndex = headers.indexOf("Floor");

          const matchedRow = sheetData.find((row, index) => {
            if (index === 0) return false;
            return row[categoryIndex] === mainCategory && 
                   row[subcategoryIndex] === subCategory &&
                   row[detail1Index] === mechanicalDetail &&
                   row[detail2Index] === mechanicalDetail2 &&
                   row[locationIndex] === work.montajYeri;
          });
          
          if (matchedRow && matchedRow[floorIndex]) {
            setKatBilgisi(matchedRow[floorIndex]);
          } else {
            setKatBilgisi("");
          }

          // 3. Excel'den 'Miktar' bilgilerini yeniden y√ºkle (handleIsTanimiSelect'ten alƒ±nan mantƒ±k)
          const descriptionIndex = headers.indexOf("Description");
          const totalIndex = headers.indexOf("Total");
          const installedIndex = headers.indexOf("Installed");
          const remainingIndex = headers.indexOf("Remaining");
          const unitIndex = headers.indexOf("Unit");
          const capacityIndex = headers.indexOf("Capacity");
          const sizeIndex = headers.indexOf("Size");

          const matchedRowMiktar = sheetData.find((row, index) => {
            if (index === 0) return false;
            return row[categoryIndex] === mainCategory && 
                   row[subcategoryIndex] === subCategory &&
                   row[detail1Index] === mechanicalDetail &&
                   row[detail2Index] === mechanicalDetail2 &&
                   row[locationIndex] === work.montajYeri &&
                   row[descriptionIndex] === work.yapilacakIsTanimi;
          });

          if (matchedRowMiktar) {
            setToplamMiktar(matchedRowMiktar[totalIndex] || "");
            setMontajMiktari(matchedRowMiktar[installedIndex] || "");
            setKalanMiktar(matchedRowMiktar[remainingIndex] || "");
            // Birim, Kapasite ve √ñl√ß√º'y√º de Excel'den tekrar set et (isteƒüe baƒülƒ± ama daha tutarlƒ±)
            setBirim(matchedRowMiktar[unitIndex] || "");
            setKapasite(matchedRowMiktar[capacityIndex] || "");
            setOlcu(matchedRowMiktar[sizeIndex] || "");
          } else {
            setToplamMiktar("");
            setMontajMiktari("");
            setKalanMiktar("");
          }
        }
      }
    }
  };

  // ƒ∞≈ü sil
  const handleDelete = (id) => {
    setWorkList(workList.filter(item => item.id !== id));
  };

// D√ºzenlemeyi iptal et
const handleCancel = () => {
  setEditingId(null);
  // Formu tamamen temizle
  setMontajYeri("");
  setKatBilgisi("");
  setYapilacakIsTanimi("");
  setToplamMiktar("");
  setMontajMiktari("");
  setKalanMiktar("");
  setBirim("");
  setKapasite("");
  setOlcu("");
  setMiktar("");
  setErrors({}); // Hatalarƒ± da temizle
};

  return (
    <div className="space-y-6">
      <div className="section">
        <h3 className="section-title">
          {mainCategory} - {subCategory} Raporu
        </h3>
        
        <div className="form-rows">
          {/* 1. Satƒ±r */}
          <div style={{
            display: "grid",
            gridTemplateColumns: "2.5fr 1.5fr",
            gap: "1rem",
            marginBottom: "1rem"
          }}>
            <div className="form-group" style={{ position: "relative" }}>
              <label className="form-label">Montaj Yeri-Mahal</label>
              <input
                value={montajYeri}
                onChange={(e) => {
                  setMontajYeri(e.target.value);
                  setShowMontajYeriSuggestions(true);
                }}
                onFocus={() => setShowMontajYeriSuggestions(true)}
                onBlur={() => setTimeout(() => setShowMontajYeriSuggestions(false), 150)}
                className={inputStyles}
                placeholder="Montaj yerini yazƒ±n veya se√ßin"
              />
              {errors.montajYeri && (
                <div className="text-red-500 text-xs mt-1">
                  {errors.montajYeri}
                </div>
              )}
              {showMontajYeriSuggestions && montajYeriOptions
                .filter(yer => {
                  if (!montajYeri) return true;
                  return yer.toLowerCase().includes(montajYeri.toLowerCase());
                })
                .length > 0 && (
                <div className="suggestions-list">
                  {montajYeriOptions
                    .filter(yer => {
                      if (!montajYeri) return true;
                      return yer.toLowerCase().includes(montajYeri.toLowerCase());
                    })
                    .map((yer, index) => (
                      <div
                        key={index}
                        className="suggestion-item"
                        onMouseDown={(e) => {
                          e.preventDefault();
                          setMontajYeri(yer);
                          setShowMontajYeriSuggestions(false);
                          handleMontajYeriSelect(yer);
                        }}
                      >
                        {yer}
                      </div>
                    ))}
                </div>
              )}
            </div>

            <div className="form-group">
              <label className="form-label">Kat Bilgisi</label>
              <input
                value={katBilgisi}
                readOnly
                className={inputStyles}
                style={{ backgroundColor: "#f5f5f5", color: "#6b7280" }}
              />
            </div>
          </div>

          {/* 2. Satƒ±r - Sadece Yapƒ±lacak i≈üin tanƒ±mƒ± */}
          <div style={{
            display: "grid",
            gridTemplateColumns: "1fr",
            gap: "1rem",
            marginBottom: "1rem"
          }}>
            <div className="form-group" style={{ position: "relative" }}>
              <label className="form-label">Yapƒ±lacak i≈üin tanƒ±mƒ±</label>
              <input
                value={yapilacakIsTanimi}
                onChange={(e) => {
                  setYapilacakIsTanimi(e.target.value);
                  setShowYapilacakIsSuggestions(true);
                }}
                onFocus={() => setShowYapilacakIsSuggestions(true)}
                onBlur={() => setTimeout(() => setShowYapilacakIsSuggestions(false), 150)}
                className={inputStyles}
                placeholder="ƒ∞≈ü tanƒ±mƒ±nƒ± yazƒ±n veya se√ßin"
              />
              {errors.isTanimi && (
                <div className="text-red-500 text-xs mt-1">
                  {errors.isTanimi}
                </div>
              )}
              {showYapilacakIsSuggestions && isTanimiOptions
                .filter(is => {
                  if (!yapilacakIsTanimi) return true;
                  return is.toLowerCase().includes(yapilacakIsTanimi.toLowerCase());
                })
                .length > 0 && (
                <div className="suggestions-list">
                  {isTanimiOptions
                    .filter(is => {
                      if (!yapilacakIsTanimi) return true;
                      return is.toLowerCase().includes(yapilacakIsTanimi.toLowerCase());
                    })
                    .map((is, index) => (
                      <div
                        key={index}
                        className="suggestion-item"
                        onMouseDown={(e) => {
                          e.preventDefault();
                          setYapilacakIsTanimi(is);
                          setShowYapilacakIsSuggestions(false);
                          handleIsTanimiSelect(is);
                        }}
                      >
                        {is}
                      </div>
                    ))}
                </div>
              )}
            </div>
          </div>

          {/* 3. Satƒ±r - Toplam Miktar, Montaj Miktarƒ±, Kalan Miktar, Birim */}
          <div style={{
            display: "grid",
            gridTemplateColumns: "1fr 1fr 1fr 1fr",
            gap: "1rem",
            marginBottom: "1rem"
          }}>
            <div className="form-group">
              <label className="form-label">Toplam Miktar</label>
              <input
                value={toplamMiktar}
                readOnly
                className={inputStyles}
                style={{ backgroundColor: "#f5f5f5", color: "#6b7280" }}
              />
            </div>

            <div className="form-group">
              <label className="form-label">Montaj Miktarƒ±</label>
              <input
                value={montajMiktari}
                readOnly
                className={inputStyles}
                style={{ backgroundColor: "#f5f5f5", color: "#6b7280" }}
              />
            </div>

            <div className="form-group">
              <label className="form-label">Kalan Miktar</label>
              <input
                value={kalanMiktar}
                readOnly
                className={inputStyles}
                style={{ backgroundColor: "#f5f5f5", color: "#6b7280" }}
              />
            </div>

            <div className="form-group">
              <label className="form-label">Birim</label>
              <input
                value={birim}
                readOnly
                className={inputStyles}
                style={{ backgroundColor: "#f5f5f5", color: "#6b7280" }}
              />
            </div>
          </div>

          {/* 4. Satƒ±r - Kapasite, √ñl√ß√º, Raporlama Miktarƒ±, Ekle Butonu */}
          <div style={{
            display: "grid",
            gridTemplateColumns: "1fr 1fr 1fr 1fr",
            gap: "1rem",
            alignItems: "end"
          }}>
            <div className="form-group">
              <label className="form-label">Kapasite</label>
              <input
                value={kapasite}
                readOnly
                className={inputStyles}
                style={{ backgroundColor: "#f5f5f5", color: "#6b7280" }}
              />
            </div>

            <div className="form-group">
              <label className="form-label">√ñl√ß√º</label>
              <input
                value={olcu}
                readOnly
                className={inputStyles}
                style={{ backgroundColor: "#f5f5f5", color: "#6b7280" }}
              />
            </div>

            <div className="form-group">
              <label className="form-label">Raporlama Miktarƒ±</label>
              <input
                type="number"
                value={miktar}
                onChange={(e) => handleMiktarChange(e.target.value)}
                min="0"
                max={getMaxMiktar()}
                className={inputStyles}
                placeholder="0"
              />
              {errors.miktar && (
                <div className="text-red-500 text-xs mt-1">
                  {errors.miktar}
                </div>
              )}
            </div>

            <div className="form-group">
              {editingId ? (
                <div style={{ display: "flex", gap: "0.5rem" }}>
                  <button
                    onClick={handleAdd}
                    className={buttonStyles.success}
                    style={{ flex: 1 }}
                  >
                    G√ºncelle
                  </button>
                  <button
                    onClick={handleCancel}
                    className={buttonStyles.secondary}
                    style={{ flex: 1 }}
                  >
                    ƒ∞ptal
                  </button>
                </div>
              ) : (
                <button
                  onClick={handleAdd}
                  className={buttonStyles.success}
                  style={{ width: "100%" }}
                >
                  + Ekle {workList.length + 1}.
                </button>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* ƒ∞≈ü Listesi */}
      {workList.length > 0 && (
        <div className="section">
          <h4 className="section-title">Eklenen ƒ∞≈üler</h4>
          <div className="manpower-table-container">
            <table className="data-table" style={{ tableLayout: 'fixed', width: '100%' }}>
              <thead>
                <tr>
                  <th style={{ width: '35%' }}>Yapƒ±lan i≈ü</th>
                  <th style={{ width: '15%' }}>Kapasite/√ñl√ß√º</th>
                  <th style={{ width: '23%' }}>Montaj Yeri-Mahal</th>
                  <th style={{ width: '10%' }}>Miktar</th>
                  <th style={{ width: '7%' }}>Birim</th>
                  <th style={{ width: '10%' }}>ƒ∞≈ülem</th>
                </tr>
              </thead>
              <tbody>
                {workList.map((work) => (
                  <tr key={work.id}>
                    <td style={{ 
                      whiteSpace: 'normal', 
                      lineHeight: '1.3', 
                      wordWrap: 'break-word',
                      maxWidth: '200px'
                    }}>
                      {work.yapilacakIsTanimi}
                    </td>
                    <td>{getCapacityDisplay(work.kapasite, work.olcu)}</td>
                    <td>{work.montajYeri}</td>
                    <td>{work.miktar}</td>
                    <td>{work.birim}</td>
                    <td>
                      <div className="compact-action-buttons">
                        <button
                          onClick={() => handleEdit(work.id)}
                          className={`${buttonStyles.edit} ${buttonStyles.small} compact-button`}
                        >
                          D√ºzenle
                        </button>
                        <button
                          onClick={() => handleDelete(work.id)}
                          className={`${buttonStyles.danger} ${buttonStyles.small} compact-button`}
                        >
                          Sil
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}
    </div>
  );
}

      // Elektrik ve Enstruman Detay Se√ßici Bile≈üeni
      function EIDetailSelector({
        subCategory,
        eiDetail1,
        eiDetail2,
        onDetail1Change,
        onDetail2Change,
      }) {
        if (!subCategory || !eiDetailOptions[subCategory]) return null;

        const options = eiDetailOptions[subCategory];

        // Kategori t√ºrlerini belirle
        const isCableWork =
          subCategory === "Kablo √áekimi" ||
          subCategory === "Kablo Baƒülantƒ±larƒ±";
        const isCableTray = subCategory === "Kablo Kanalƒ± (Tavasƒ±) Montajƒ±";

        return (
          <div className="ei-detail-selector mb-4">
            <div>
              <label className="form-label">Detay-1</label>
              <select
                value={eiDetail1}
                onChange={(e) => onDetail1Change(e.target.value)}
                className={`${selectStyles} detail-select`}
              >
                <option value="">Se√ßiniz</option>
                {options.detail1.map((option, index) => (
                  <option key={index} value={option}>
                    {option}
                  </option>
                ))}
              </select>
            </div>

            {/*  DETAY-2 KUTUSU */}
            <div>
              <label className="form-label">Detay-2</label>
              {isCableWork ? (
                // Kablo √áekimi ve Baƒülantƒ±larƒ± i√ßin READ-ONLY INPUT
                <input
                  type="text"
                  value={eiDetail2 || "-"}
                  readOnly
                  className={inputStyles}
                  placeholder="Cable Tag se√ßildiƒüinde dolacak"
                />
              ) : isCableTray ? (
                // Kablo Kanalƒ± i√ßin SELECT KUTUSU
                <select
                  value={eiDetail2}
                  onChange={(e) => onDetail2Change(e.target.value)}
                  className={`${selectStyles} detail-select`}
                >
                  <option value="">Se√ßiniz</option>
                  {options.detail2 &&
                    options.detail2.map((option, index) => (
                      <option key={index} value={option}>
                        {option}
                      </option>
                    ))}
                </select>
              ) : (
                // Diƒüer kategoriler i√ßin bo≈ü
                <input
                  type="text"
                  value=""
                  readOnly
                  className={inputStyles}
                  style={{ display: "none" }} // Gizle
                />
              )}
            </div>
          </div>
        );
      }

// Mechanical Alt Kategori Se√ßici
function MechanicalSubCategorySelector({
  subCategory,
  mechanicalDetail,
  mechanicalDetail2,
  onDetailChange,
  onDetail2Change,
  excelData // YENƒ∞: Excel verilerini alacak
}) {
  if (!subCategory || !mechanicalSubCategories[subCategory]) return null;

  // Hari√ß tutulan alt kategoriler
  const isExcludedSubCategory = subCategory === "Ekstra ƒ∞≈üler" || subCategory === "Radyat√∂r Demo";

  // Excel'den Detay-1 ve Detay-2 verilerini al
  const getExcelDetails = () => {
    if (!excelData || !excelData["Mekanik"]) {
      return { detail1Options: [], detail2Options: [] };
    }

    const sheetData = excelData["Mekanik"];
    if (sheetData.length < 2) return { detail1Options: [], detail2Options: [] };

    // Ba≈ülƒ±klarƒ± bul
    const headers = sheetData[0];
    const categoryIndex = headers.indexOf("Category");
    const subcategoryIndex = headers.indexOf("Subcategory");
    const detail1Index = headers.indexOf("Detail_1");
    const detail2Index = headers.indexOf("Detail_2");

    // Ge√ßerli kategori ve alt kategoriye uygun satƒ±rlarƒ± filtrele
    const filteredRows = sheetData.filter((row, index) => {
      if (index === 0) return false; // Ba≈ülƒ±k satƒ±rƒ±nƒ± atla
      return row[categoryIndex] === "Mekanik" && row[subcategoryIndex] === subCategory;
    });

    // Detay-1 se√ßeneklerini al (tekrarlarƒ± kaldƒ±r)
    const detail1Options = [...new Set(filteredRows
      .map(row => row[detail1Index])
      .filter(Boolean))]; // Bo≈ü olmayan deƒüerleri al

    // Detay-2 se√ßeneklerini al (mechanicalDetail'e g√∂re filtrele ve tekrarlarƒ± kaldƒ±r)
    const detail2Options = mechanicalDetail 
      ? [...new Set(filteredRows
          .filter(row => row[detail1Index] === mechanicalDetail)
          .map(row => row[detail2Index])
          .filter(Boolean))] // Bo≈ü olmayan deƒüerleri al
      : [];

    return { detail1Options, detail2Options };
  };

  const { detail1Options, detail2Options } = getExcelDetails();

  // Radyat√∂r Demo i√ßin Detay-2 se√ßenekleri
  const radyatorDemoDetail2Options = mechanicalDetail === "Isƒ±tƒ±cƒ± Montajƒ±" 
    ? ["Radyat√∂r", "Radyant Isƒ±tƒ±cƒ±", "Sƒ±cak Hava √úreteci ve Cihazƒ±"] 
    : [];

  // Detay-2'nin kilitli olup olmayacaƒüƒ±nƒ± belirle
  // Sadece "Ekstra ƒ∞≈üler" ve "Radyat√∂r Demo" hari√ß diƒüer kategoriler i√ßin kontrol et
  const isDetail2Locked = !isExcludedSubCategory && 
    (detail2Options.length === 0 || (detail2Options.length === 1 && detail2Options[0] === "-"));

  // Detay-1 se√ßildiƒüinde Detay-2'yi otomatik olarak "-" yap (sadece "-" varsa ve hari√ß tutulan kategoriler deƒüilse)
  React.useEffect(() => {
    if (!isExcludedSubCategory && mechanicalDetail && detail2Options.length === 1 && detail2Options[0] === "-") {
      onDetail2Change("-");
    }
  }, [mechanicalDetail, detail2Options, isExcludedSubCategory, onDetail2Change]);

  return (
    <div className="ei-detail-selector mb-4">
      <div>
        <label className="form-label">Detay-1</label>
        <select
          value={mechanicalDetail}
          onChange={(e) => {
            onDetailChange(e.target.value);
            onDetail2Change(""); // Detay-1 deƒüi≈üince Detay-2'yi sƒ±fƒ±rla
          }}
          className={`${selectStyles} detail-select`}
        >
          <option value="">Se√ßiniz</option>
          {isExcludedSubCategory ? (
            // Hari√ß tutulan alt kategoriler i√ßin statik se√ßenekler
            <>
              {mechanicalSubCategories[subCategory].map((option, index) => (
                <option key={index} value={option}>
                  {option}
                </option>
              ))}
              <option value="Diƒüer">Diƒüer</option>
            </>
          ) : (
            // Diƒüer alt kategoriler i√ßin Excel'den gelen se√ßenekler
            <>
              {detail1Options.map((option, index) => (
                <option key={index} value={option}>
                  {option}
                </option>
              ))}
            </>
          )}
        </select>
      </div>
      <div>
        <label className="form-label">Detay-2</label>
        <select
          value={mechanicalDetail2}
          onChange={(e) => onDetail2Change(e.target.value)}
          className={`${selectStyles} detail-select`}
          disabled={
            // Radyat√∂r Demo i√ßin √∂zel durum - sadece Isƒ±tƒ±cƒ± Montajƒ± se√ßildiƒüinde aktif
            subCategory === "Radyat√∂r Demo" 
              ? !(mechanicalDetail === "Isƒ±tƒ±cƒ± Montajƒ±")
              : isExcludedSubCategory 
                ? (!mechanicalDetail || detail2Options.length === 0) 
                : (!mechanicalDetail || isDetail2Locked)
          }
        >
          <option value="">Se√ßiniz</option>
          {subCategory === "Radyat√∂r Demo" ? (
            // Radyat√∂r Demo i√ßin statik se√ßenekler
            radyatorDemoDetail2Options.map((option, index) => (
              <option key={index} value={option}>
                {option}
              </option>
            ))
          ) : isExcludedSubCategory ? (
            // Ekstra ƒ∞≈üler i√ßin statik se√ßenekler (mevcutta yok)
            mechanicalDetail === "Isƒ±tƒ±cƒ± Montajƒ±" && ["Radyat√∂r", "Radyant Isƒ±tƒ±cƒ±", "Sƒ±cak Hava √úreteci ve Cihazƒ±"].map((option, index) => (
              <option key={index} value={option}>
                {option}
              </option>
            ))
          ) : (
            // Diƒüer alt kategoriler i√ßin Excel'den gelen se√ßenekler
            detail2Options.map((option, index) => (
              <option key={index} value={option}>
                {option}
              </option>
            ))
          )}
        </select>
      </div>
    </div>
  );
}


      // Cable Schedule √ñnizleme Bile≈üeni (Filtrelemeli ve Veri Odaklƒ±)
      function CableSchedulePreview({ excelData, eiDetail1, onClose }) {
        const [cables, setCables] = React.useState([]);
        const [searchTerm, setSearchTerm] = React.useState("");
        const [filters, setFilters] = React.useState({
          cableTag: "",
          cableType: "",
          cableSize: "",
          from: "",
          to: "",
          designLength: "",
          actualLength: "",
          drumNo: "",
          status: "",
          drawing: "",
          rev: "",
        });

        // Dinamik sayfa ve ba≈ülƒ±k e≈ülemeleri
        const sheetNameMap = {
          Elektrik: "Electrical",
          Enstr√ºman: "Instrumentation",
          Telekom: "Telecom",
        };

        const titleMap = {
          Elektrik: "Electrical Cable Schedule",
          Enstr√ºman: "Instrumentation Cable Schedule",
          Telekom: "Telecom Cable Schedule",
        };

        // Status kodlarƒ±nƒ± a√ßƒ±klamalara e≈üle
        const statusMap = {
          0: "Bekliyor",
          1: "√áekildi",
          2: "ƒ∞PTAL",
          3: "√áekildi-Satƒ±≈ü YOK-ƒ∞PTAL",
          4: "√áekildi-Satƒ±≈ü VAR-ƒ∞PTAL",
          5: "Hasarlƒ±- Satƒ±≈ü YOK - Tekrar √áek",
          6: "Hasarlƒ±- Satƒ±≈ü YOK - Tekrar √áekildi",
          7: "Hasarlƒ±- Satƒ±≈ü VAR - Tekrar √áek",
          8: "Hasarlƒ±- Satƒ±≈ü VAR - Tekrar √áekildi",
        };

        // Excel ba≈ülƒ±klarƒ±nƒ± state'deki 'key' adlarƒ±na e≈üle
        const headerKeys = {
          Cable_Tag: "cableTag",
          Cable_Type: "cableType",
          Cable_Size: "cableSize",
          From_Source: "from",
          To_User: "to",
          Design_Length: "designLength",
          Actual_Length: "actualLength", // Excel'de bu veri olmasa bile s√ºtunu olu≈üturuyoruz
          Drum_Number: "drumNo",
          Status: "status",
          Drawing_No: "drawing",
          Revision: "rev",
        };

        // G√∂sterilecek ba≈ülƒ±klar ve istenen sƒ±ra
        const displayHeaders = [
          { key: "cableTag", label: "Cable Tag" },
          { key: "cableType", label: "Cable Type" },
          { key: "cableSize", label: "Cable Size" },
          { key: "from", label: "From (Source)" },
          { key: "to", label: "To (User)" },
          { key: "designLength", label: "Design Length (m)" },
          { key: "actualLength", label: "Actual Length (m)" },
          { key: "drumNo", label: "Drum No" },
          { key: "status", label: "Status" },
          { key: "drawing", label: "Drawing" },
          { key: "rev", label: "Rev" },
        ];

        // Veriyi Excel'den parse et
        React.useEffect(() => {
          const sheetName = sheetNameMap[eiDetail1];
          if (!excelData || !sheetName || !excelData[sheetName]) {
            setCables([]);
            return;
          }

          const sheetData = excelData[sheetName];
          if (sheetData.length < 2) {
            setCables([]);
            return;
          }

          const excelHeaders = sheetData[0];
          const indices = {};
          // Excel ba≈ülƒ±klarƒ±nƒ±n index'lerini bul
          Object.keys(headerKeys).forEach((excelHeader) => {
            indices[headerKeys[excelHeader]] =
              excelHeaders.indexOf(excelHeader);
          });

          const parsedCables = [];
          for (let i = 1; i < sheetData.length; i++) {
            const row = sheetData[i];
            if (!row || row.length === 0) continue;

            const cable = {};
            displayHeaders.forEach((header) => {
              const index = indices[header.key];
              if (index !== -1 && row[index] !== undefined) {
                cable[header.key] = row[index];
              } else {
                cable[header.key] = null; // S√ºtun bulunamazsa veya bo≈üsa
              }
            });
            parsedCables.push(cable);
          }
          setCables(parsedCables);
        }, [excelData, eiDetail1]);

        // Filtre se√ßenekleri i√ßin unique deƒüerleri hesapla (optimizasyon)
        const uniqueFilterOptions = React.useMemo(() => {
          const options = {};
          displayHeaders.forEach((header) => {
            // 'status' i√ßin statusMap'teki a√ßƒ±klamalarƒ± kullan
            if (header.key === "status") {
              const values = new Set(
                cables
                  .map((c) => statusMap[c.status] || c.status)
                  .filter(Boolean),
              );
              options[header.key] = Array.from(values).sort();
            } else {
              const values = new Set(
                cables
                  .map((c) => c[header.key])
                  .filter((val) => val !== null && val !== undefined),
              );
              options[header.key] = Array.from(values).sort((a, b) =>
                String(a).localeCompare(String(b)),
              );
            }
          });
          return options;
        }, [cables]);

        // Filtrelenmi≈ü kablolarƒ± hesapla (optimizasyon)
        const filteredCables = React.useMemo(() => {
          return cables.filter((cable) => {
            // Global arama
            if (searchTerm) {
              const mappedStatus = statusMap[cable.status] || cable.status;
              const searchableValues = { ...cable, status: mappedStatus };

              const foundInSearch = Object.values(searchableValues).some(
                (val) =>
                  String(val).toLowerCase().includes(searchTerm.toLowerCase()),
              );
              if (!foundInSearch) return false;
            }

            // S√ºtun filtreleri
            for (const key of Object.keys(filters)) {
              if (!filters[key]) continue;

              let cableValue = cable[key];
              if (key === "status") {
                cableValue = statusMap[cable.status] || cable.status;
              }

              if (String(cableValue || "") !== String(filters[key])) {
                return false;
              }
            }
            return true;
          });
        }, [cables, searchTerm, filters]);

        const handleFilterChange = (key, value) => {
          setFilters((prev) => ({ ...prev, [key]: value }));
        };

        const clearAllFilters = () => {
          setSearchTerm("");
          setFilters({
            cableTag: "",
            cableType: "",
            cableSize: "",
            from: "",
            to: "",
            designLength: "",
            actualLength: "",
            drumNo: "",
            status: "",
            drawing: "",
            rev: "",
          });
        };

        // CSS Stili (word-break i√ßin)
        const statusCellStyle = {
          wordBreak: "break-word",
          minWidth: "150px",
          maxWidth: "200px",
          lineHeight: "1.3",
        };

        const defaultCellStyle = {
          minWidth: "100px",
        };

        // Sayƒ±sal deƒüerleri iki ondalƒ±k basamaƒüa formatlayan yardƒ±mcƒ± fonksiyon
        const formatNumber = (val) => {
          // Bo≈ü/undefined/null i√ßin g√∂sterim
          if (val === null || val === undefined || val === "") return "-";

          // String'e √ßevir ve bo≈üluklarƒ± temizle
          let str = String(val).trim().replace(/\s+/g, "");

          // Eƒüer hem nokta hem virg√ºl varsa, sondaki i≈üaret ondalƒ±k ayƒ±rƒ±cƒ± olabilir
          if (str.includes(".") && str.includes(",")) {
            if (str.lastIndexOf(",") > str.lastIndexOf(".")) {
              // Virg√ºl ondalƒ±k, nokta binlik -> noktalarƒ± sil, virg√ºl√º noktaya √ßevir
              str = str.replace(/\./g, "").replace(",", ".");
            } else {
              // Nokta ondalƒ±k, virg√ºl binlik -> virg√ºlleri sil
              str = str.replace(/,/g, "");
            }
          } else if (str.includes(",")) {
            // Sadece virg√ºl varsa virg√ºl√º ondalƒ±k noktaya √ßevir
            str = str.replace(",", ".");
          }

          // Son olarak sayƒ±ya d√∂n√º≈üt√ºr
          const num = Number(str);
          if (Number.isNaN(num)) return String(val);

          // Her zaman iki ondalƒ±k g√∂ster
          return num.toFixed(2);
        };

        return (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            {/* max-w-7xl -> Daha geni≈ü modal */}
            <div className="bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[90vh] flex flex-col">
              <div className="flex justify-between items-center p-4 border-b">
                <h2 className="text-xl font-semibold">
                  {titleMap[eiDetail1] || "Cable Schedule"}
                </h2>
                <button
                  onClick={onClose}
                  className="text-gray-500 hover:text-gray-700 text-2xl"
                >
                  √ó
                </button>
              </div>

              <div className="p-4 border-b flex items-center gap-4">
                <input
                  type="text"
                  placeholder="T√ºm listede ara..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="form-input w-1/3"
                />
                <button
                  onClick={clearAllFilters}
                  className={buttonStyles.secondary}
                >
                  T√ºm Filtreleri Temizle
                </button>
              </div>

              <div className="flex-1 overflow-auto">
                <table className="data-table w-full">
                  <thead>
                    <tr>
                      {displayHeaders.map((header) => (
                        <th key={header.key} className="p-2 border align-top">
                          <div className="flex flex-col gap-1">
                            <span>{header.label}</span>
                            <select
                              value={filters[header.key]}
                              onChange={(e) =>
                                handleFilterChange(header.key, e.target.value)
                              }
                              className="form-select text-xs p-1"
                            >
                              <option value="">T√ºm√º</option>
                              {uniqueFilterOptions[header.key].map((option) => (
                                <option key={option} value={option}>
                                  {option}
                                </option>
                              ))}
                            </select>
                          </div>
                        </th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {filteredCables.length > 0 ? (
                      filteredCables.map((cable, index) => (
                        <tr key={index} className="hover:bg-gray-50">
                          {displayHeaders.map((header) => (
                            <td
                              key={header.key}
                              className="p-2 border text-xs"
                              style={
                                header.key === "status"
                                  ? statusCellStyle
                                  : defaultCellStyle
                              }
                            >
                              {header.key === "status"
                                ? statusMap[cable.status] || cable.status
                                : header.key === "designLength"
                                  ? // Design Length: her zaman iki ondalƒ±k basamakla g√∂ster
                                    formatNumber(cable.designLength)
                                  : header.key === "actualLength"
                                    ? // Actual Length: her zaman iki ondalƒ±k basamakla g√∂ster
                                      formatNumber(cable.actualLength)
                                    : cable[header.key]}
                            </td>
                          ))}
                        </tr>
                      ))
                    ) : (
                      <tr>
                        <td
                          colSpan={displayHeaders.length}
                          className="text-center py-8 text-gray-500"
                        >
                          Veri bulunamadƒ± veya filtrelerle e≈üle≈ümedi.
                        </td>
                      </tr>
                    )}
                  </tbody>
                </table>
              </div>

              <div className="p-4 border-t bg-gray-50 flex justify-between items-center">
                <div className="text-sm text-gray-600">
                  Toplam {filteredCables.length} kablo listeleniyor (Toplam{" "}
                  {cables.length} kayƒ±ttan)
                </div>
                <button onClick={onClose} className={buttonStyles.primary}>
                  Kapat
                </button>
              </div>
            </div>
          </div>
        );
      }

      // RFI Form Bile≈üeni
      function RFIForm({ currentSubcontractor }) {
        const [rfiList, setRfiList] = React.useState([]);
        const [currentRfi, setCurrentRfi] = React.useState({
          requestDate: new Date().toISOString().split("T")[0],
          mainCategory: "",
          subCategory: "",
          description: "",
        });

        const handleCreateRfi = () => {
          alert(
            "RFI olu≈üturma i≈ülevi devre dƒ±≈üƒ± - Bu sadece g√∂rsel bir ≈üablondur",
          );
        };

        return (
          <div className="space-y-6">
            <div className="section">
              <div className="section-header">
                <h3 className="section-title">Yeni RFI Olu≈ütur</h3>
              </div>
              <div className="form-rows">
                <div className="category-form-row">
                  <div className="form-group">
                    <label className="form-label">Ana Kategori</label>
                    <select
                      value={currentRfi.mainCategory}
                      onChange={(e) =>
                        setCurrentRfi((prev) => ({
                          ...prev,
                          mainCategory: e.target.value,
                          subCategory: "",
                        }))
                      }
                      className={selectStyles}
                    >
                      <option value="">Se√ßiniz</option>
                      {initialCategories.mainCategories.map((cat, index) => (
                        <option key={index} value={cat}>
                          {cat}
                        </option>
                      ))}
                    </select>
                  </div>
                  <div className="form-group">
                    <label className="form-label">Alt Kategori</label>
                    <select
                      value={currentRfi.subCategory}
                      onChange={(e) =>
                        setCurrentRfi((prev) => ({
                          ...prev,
                          subCategory: e.target.value,
                        }))
                      }
                      disabled={!currentRfi.mainCategory}
                      className={`${selectStyles} subcategory-select disabled:bg-gray-100`}
                    >
                      <option value="">Se√ßiniz</option>
                      {initialCategories.subCategories[
                        currentRfi.mainCategory
                      ]?.map((subCat, index) => (
                        <option key={index} value={subCat}>
                          {subCat}
                        </option>
                      ))}
                    </select>
                  </div>
                </div>
                <div className="form-group">
                  <label className="form-label">A√ßƒ±klama</label>
                  <textarea
                    value={currentRfi.description}
                    onChange={(e) =>
                      setCurrentRfi((prev) => ({
                        ...prev,
                        description: e.target.value,
                      }))
                    }
                    className="form-textarea h-20"
                    placeholder="RFI a√ßƒ±klamasƒ±nƒ± giriniz..."
                  />
                </div>
                <div className="mt-4">
                  <button
                    onClick={handleCreateRfi}
                    className={buttonStyles.primary}
                  >
                    RFI Olu≈ütur
                  </button>
                </div>
              </div>
            </div>

            <div className="section">
              <div className="section-header">
                <h3 className="section-title">RFI Listesi</h3>
                <div className="w-64">
                  <input
                    type="text"
                    placeholder="RFI numarasƒ± ara..."
                    className="form-input"
                  />
                </div>
              </div>
              <p className="text-gray-500 text-center py-4">
                Hen√ºz RFI olu≈üturulmamƒ±≈ü.
              </p>
            </div>
          </div>
        );
      }

      // NCR Raporlarƒ± Bile≈üeni
      function NCRReportsView() {
        const [searchTerm, setSearchTerm] = React.useState("");

        return (
          <div className="space-y-6">
            <div className="section">
              <div className="section-header">
                <h3 className="section-title">NCR Listesi</h3>
                <div className="w-96">
                  <input
                    type="text"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    placeholder="NCR ara (numara, proje, ekipman...)"
                    className="form-input"
                  />
                </div>
              </div>
              <div className="overflow-x-auto">
                <table className="data-table">
                  <thead>
                    <tr>
                      <th>NCR Number</th>
                      <th>Project</th>
                      <th>Issued Date</th>
                      <th>Issued By</th>
                      <th>Receiver</th>
                      <th>Equipment</th>
                      <th>Tag/serial number</th>
                      <th>QTY</th>
                      <th>Non-conformity category</th>
                      <th>Status</th>
                      <th>Form</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td
                        colSpan="11"
                        className="text-center py-4 text-gray-500"
                      >
                        Kriterlere uygun NCR bulunamadƒ±.
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        );
      }

      // Manpower Tablo Header Bile≈üeni - REUSABLE
      function ManpowerTableHeader() {
        return (
          <thead>
            <tr>
              {manpowerTableHeaders.map((header, index) => (
                <th key={index}>{header}</th>
              ))}
            </tr>
          </thead>
        );
      }

      // Manpower Form Bile≈üeni - Excel Verisi ile Hiyerar≈üik Yapƒ±
      function ManpowerForm({
        personnel,
        onSave,
        subcontractor,
        date,
        shift,
        onDateChange,
        onShiftChange,
        excelData,
        currentSubcontractor,
      }) {
        const [expandedSections, setExpandedSections] = React.useState({});
        const [personnelData, setPersonnelData] = React.useState([]);
        const [personnelHierarchy, setPersonnelHierarchy] = React.useState([]);
        const [selectedPersonnel, setSelectedPersonnel] = React.useState({});
        const [personnelCategories, setPersonnelCategories] = React.useState(
          {},
        );
        const [personnelHours, setPersonnelHours] = React.useState({});

        // Excel verilerini i≈üle ve hiyerar≈üi olu≈ütur
        React.useEffect(() => {
          if (!excelData || !currentSubcontractor) return;

          const sheetName = currentSubcontractor.number;
          const sheetData = excelData[sheetName];

          if (!sheetData) {
            console.warn(`Sayfa bulunamadƒ±: ${sheetName}`);
            return;
          }

          // Ba≈ülƒ±klarƒ± bul
          const headers = sheetData[0];
          const personalIdIndex = headers.indexOf("Personal_ID");
          const nameIndex = headers.indexOf("Name");
          const surnameIndex = headers.indexOf("Surname");
          const positionIndex = headers.indexOf("Position");
          const categoryIndex = headers.indexOf("Catagory");
          const workingTypeIndex = headers.indexOf("Working_Type");
          const workCategoryIndex = headers.indexOf("Work_Category");
          const manager1Index = headers.indexOf("Manager_1");
          const manager2Index = headers.indexOf("Manager_2");

          // Veri satƒ±rlarƒ±nƒ± i≈üle
          const personnelList = [];
          for (let i = 1; i < sheetData.length; i++) {
            const row = sheetData[i];
            if (row.length === 0) continue;

            const personnel = {
              id: row[personalIdIndex],
              name: row[nameIndex],
              surname: row[surnameIndex],
              position: row[positionIndex],
              category: row[categoryIndex],
              workingType: row[workingTypeIndex],
              workCategory: row[workCategoryIndex],
              manager1: row[manager1Index],
              manager2: row[manager2Index],
              fullName: `${row[nameIndex]} ${row[surnameIndex]}`,
              subordinates: [],
              hasSubordinates: false,
            };
            personnelList.push(personnel);
          }

          setPersonnelData(personnelList);

          // Hiyerar≈üi olu≈ütur
          const hierarchy = buildPersonnelHierarchy(personnelList);
          setPersonnelHierarchy(hierarchy);
        }, [excelData, currentSubcontractor]);

        // Hiyerar≈üi olu≈üturma fonksiyonu
        const buildPersonnelHierarchy = (personnelList) => {
          const fullNameMap = {};
          personnelList.forEach((person) => {
            fullNameMap[person.fullName] = person;
          });

          const map = {};
          personnelList.forEach((person) => {
            map[person.id] = {
              ...person,
              subordinates: [],
              hasSubordinates: false,
            };
          });

          const tree = [];

          // ƒ∞lk olarak Manager2'ye g√∂re hiyerar≈üi kur
          personnelList.forEach((person) => {
            const current = map[person.id];

            if (person.manager2 && fullNameMap[person.manager2]) {
              const manager2Id = fullNameMap[person.manager2].id;
              if (map[manager2Id]) {
                map[manager2Id].subordinates.push(current);
                map[manager2Id].hasSubordinates = true;
                return;
              }
            }

            if (person.manager1 && fullNameMap[person.manager1]) {
              const manager1Id = fullNameMap[person.manager1].id;
              if (map[manager1Id]) {
                map[manager1Id].subordinates.push(current);
                map[manager1Id].hasSubordinates = true;
                return;
              }
            }

            tree.push(current);
          });

          // Alt elemanlarƒ± olanlarƒ± sƒ±rala: √∂nce y√∂neticiler, sonra diƒüerleri
          tree.forEach((node) => {
            if (node.subordinates.length > 0) {
              node.subordinates.sort((a, b) => {
                const aHasSubs = a.hasSubordinates;
                const bHasSubs = b.hasSubordinates;
                if (aHasSubs && !bHasSubs) return -1;
                if (!aHasSubs && bHasSubs) return 1;
                return 0;
              });
            }
          });

          return tree;
        };

        const toggleSection = (sectionId) => {
          setExpandedSections((prev) => ({
            ...prev,
            [sectionId]: !prev[sectionId],
          }));
        };

        const handlePersonnelSelect = (personnelId) => {
          setSelectedPersonnel((prev) => ({
            ...prev,
            [personnelId]: !prev[personnelId],
          }));
        };

        const handlePersonnelCategoryChange = (personnelId, category) => {
          setPersonnelCategories((prev) => ({
            ...prev,
            [personnelId]: category,
          }));
        };

        const handleHoursChange = (personnelId, hours) => {
          setPersonnelHours((prev) => ({
            ...prev,
            [personnelId]: hours,
          }));
        };

        const handleSelectAll = (personnelIds) => {
          const updatedSelection = { ...selectedPersonnel };
          personnelIds.forEach((id) => {
            updatedSelection[id] = true;
          });
          setSelectedPersonnel(updatedSelection);
        };

        const handleClearAll = (personnelIds) => {
          const updatedSelection = { ...selectedPersonnel };
          personnelIds.forEach((id) => {
            updatedSelection[id] = false;
          });
          setSelectedPersonnel(updatedSelection);
        };

        // Foreman kategorisi deƒüi≈ütiƒüinde altƒ±ndaki t√ºm personellerin kategorisini deƒüi≈ütir
        const handleForemanCategoryChange = (
          foremanId,
          category,
          subordinateIds,
        ) => {
          // Tek seferde t√ºm g√ºncellemeleri yap
          const updatedCategories = {
            ...personnelCategories,
            [foremanId]: category, // Foreman'ƒ±n kendi kategorisini g√ºncelle
          };

          const updatedSelection = { ...selectedPersonnel };

          // Foreman'ƒ±n altƒ±ndaki t√ºm personellerin kategorisini deƒüi≈ütir ve se√ßili yap
          subordinateIds.forEach((id) => {
            updatedCategories[id] = category;
            updatedSelection[id] = true;
          });

          // Tek seferde state'leri g√ºncelle
          setPersonnelCategories(updatedCategories);
          setSelectedPersonnel(updatedSelection);
        };

        // Recursive personel aƒüacƒ± render fonksiyonu - Hƒ∞YERAR≈ûƒ∞K YAPI
        const renderPersonnelTree = (nodes, level = 0) => {
          return nodes.map((node) => {
            const hasSubordinates = node.hasSubordinates;
            const isExpanded = expandedSections[node.id] || false;

            // Alt elemanlarƒ± olanlar ve olmayanlar ayrƒ±≈ütƒ±r
            const managers = node.subordinates.filter(
              (sub) => sub.hasSubordinates,
            );
            const nonManagers = node.subordinates.filter(
              (sub) => !sub.hasSubordinates,
            );

            const allSubordinateIds = node.subordinates.map((sub) => sub.id);

            return (
              <div key={node.id} className="mb-2">
                {/* Y√ñNETƒ∞Cƒ∞ B√ñL√úM√ú */}
                <div
                  className="manpower-section-header"
                  onClick={() => toggleSection(node.id)}
                >
                  <span>
                    {node.position} - {node.name} {node.surname}
                  </span>
                  <span>{hasSubordinates ? (isExpanded ? "‚ñ≤" : "‚ñº") : ""}</span>
                </div>

                {isExpanded && (
                  <div className="p-4">
                    {/* 1. √ñNCE Y√ñNETƒ∞Cƒ∞Nƒ∞N KENDƒ∞Sƒ∞ */}
                    <div className="manpower-table-container">
                      <table className="data-table manpower-table">
                        <ManpowerTableHeader />
                        <tbody>
                          <tr>
                            <td>
                              <input
                                type="checkbox"
                                checked={selectedPersonnel[node.id] || false}
                                onChange={() => handlePersonnelSelect(node.id)}
                                className="h-4 w-4 text-blue-600"
                              />
                            </td>
                            <td>{node.id}</td>
                            <td>
                              {node.name} {node.surname}
                            </td>
                            <td>{node.position}</td>
                            <td>
                              {node.workCategory === "SE√áƒ∞Nƒ∞Z" ? (
                                <select
                                  value={personnelCategories[node.id] || ""}
                                  onChange={(e) => {
                                    // Eƒüer bu bir foreman/supervizor ise, kategorisini deƒüi≈ütir ve altƒ±ndakilere uygula
                                    if (
                                      node.position
                                        .toLowerCase()
                                        .includes("foreman") ||
                                      node.position
                                        .toLowerCase()
                                        .includes("supervisor") ||
                                      node.position
                                        .toLowerCase()
                                        .includes("forman")
                                    ) {
                                      handleForemanCategoryChange(
                                        node.id,
                                        e.target.value,
                                        allSubordinateIds,
                                      );
                                    } else {
                                      handlePersonnelCategoryChange(
                                        node.id,
                                        e.target.value,
                                      );
                                    }
                                  }}
                                  className="manpower-select"
                                >
                                  <option value="">Se√ßiniz</option>
                                  {getWorkCategories().map((category) => (
                                    <option key={category} value={category}>
                                      {category}
                                    </option>
                                  ))}
                                </select>
                              ) : (
                                <input
                                  type="text"
                                  value={node.workCategory}
                                  readOnly
                                  className={inputStyles}
                                />
                              )}
                            </td>
                            <td>
                              <input
                                type="number"
                                min="1"
                                max="12"
                                value={personnelHours[node.id] || 8}
                                onChange={(e) =>
                                  handleHoursChange(node.id, e.target.value)
                                }
                                className="hours-input border rounded px-2 py-1 text-sm form-input"
                              />
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                    {/* 2. Y√ñNETƒ∞Cƒ∞YE DOƒûRUDAN BAƒûLI ALTINDA PERSONELƒ∞ OLMAYANLAR */}
                    {nonManagers.length > 0 && (
                      <div className="mt-4">
                        <div className="flex space-x-2 mb-2">
                          <button
                            onClick={() =>
                              handleSelectAll(nonManagers.map((sub) => sub.id))
                            }
                            className={buttonStyles.small}
                          >
                            T√ºm√ºn√º Se√ß
                          </button>
                          <button
                            onClick={() =>
                              handleClearAll(nonManagers.map((sub) => sub.id))
                            }
                            className={buttonStyles.small}
                          >
                            Temizle
                          </button>
                        </div>
                        <div className="manpower-table-container">
                          <table className="data-table manpower-table">
                            <ManpowerTableHeader />
                            <tbody>
                              {nonManagers.map((subordinate) => (
                                <tr key={subordinate.id}>
                                  <td>
                                    <input
                                      type="checkbox"
                                      checked={
                                        selectedPersonnel[subordinate.id] ||
                                        false
                                      }
                                      onChange={() =>
                                        handlePersonnelSelect(subordinate.id)
                                      }
                                      className="h-4 w-4 text-blue-600"
                                    />
                                  </td>
                                  <td>{subordinate.id}</td>
                                  <td>
                                    {subordinate.name} {subordinate.surname}
                                  </td>
                                  <td>{subordinate.position}</td>
                                  <td>
                                    {subordinate.workCategory === "SE√áƒ∞Nƒ∞Z" ? (
                                      <select
                                        value={
                                          personnelCategories[subordinate.id] ||
                                          ""
                                        }
                                        onChange={(e) =>
                                          handlePersonnelCategoryChange(
                                            subordinate.id,
                                            e.target.value,
                                          )
                                        }
                                        className="manpower-select"
                                      >
                                        <option value="">Se√ßiniz</option>
                                        {getWorkCategories().map((category) => (
                                          <option
                                            key={category}
                                            value={category}
                                          >
                                            {category}
                                          </option>
                                        ))}
                                      </select>
                                    ) : (
                                      <input
                                        type="text"
                                        value={subordinate.workCategory}
                                        readOnly
                                        className={inputStyles}
                                      />
                                    )}
                                  </td>
                                  <td>
                                    <input
                                      type="number"
                                      min="1"
                                      max="12"
                                      value={
                                        personnelHours[subordinate.id] || 8
                                      }
                                      onChange={(e) =>
                                        handleHoursChange(
                                          subordinate.id,
                                          e.target.value,
                                        )
                                      }
                                      className="hours-input border rounded px-2 py-1 text-sm form-input"
                                    />
                                  </td>
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    )}

                    {/* 3. Y√ñNETƒ∞Cƒ∞YE BAƒûLI ALTINDA PERSONEL OLANLAR (ƒ∞√á ƒ∞√áE SECTION'LAR) */}
                    {managers.length > 0 && (
                      <div className="mt-6">
                        {renderPersonnelTree(managers, level + 1)}
                      </div>
                    )}
                  </div>
                )}
              </div>
            );
          });
        };

        return (
          <div className="space-y-6">
            <div className="section">
              <div className="section-header">
                <h3 className="section-title">
                  Personel Listesi - {currentSubcontractor.number}
                </h3>
              </div>

              {personnelHierarchy.length > 0 ? (
                renderPersonnelTree(personnelHierarchy)
              ) : (
                <p className="text-center py-4 text-gray-500">
                  {excelData
                    ? "Personel verisi bulunamadƒ±"
                    : "Excel dosyasƒ± y√ºkleyin"}
                </p>
              )}
            </div>

            <div className="flex justify-end">
              <button className={buttonStyles.primary}>Raporu Kaydet</button>
            </div>
          </div>
        );
      }

      // Yan Men√º A√ßma/Kapama Bile≈üeni
      function SidebarToggle({ isOpen, onToggle }) {
        return (
          <button id="toggle-btn" onClick={onToggle}>
            <span id="btn-icon">{isOpen ? "¬´" : "¬ª"}</span>
            <span className="tooltip-text">
              {isOpen ? "Close Sidebar" : "Open Sidebar"}
            </span>
          </button>
        );
      }

      // Giri≈ü ekranƒ± bile≈üeni
      function LoginScreen({ onLogin }) {
        const [subcontractorNumber, setSubcontractorNumber] =
          React.useState("");
        const [password, setPassword] = React.useState("");
        const [error, setError] = React.useState("");

        const handleLogin = (e) => {
          e.preventDefault();

          if (!subcontractorNumber || !password) {
            setError("L√ºtfen alt y√ºklenici numarasƒ± ve ≈üifre giriniz.");
            return;
          }

          const subcontractor = subcontractors[subcontractorNumber];

          if (!subcontractor) {
            setError("Ge√ßersiz alt y√ºklenici numarasƒ±.");
            return;
          }

          if (subcontractor.password !== password) {
            setError("Ge√ßersiz ≈üifre.");
            return;
          }

          onLogin(subcontractorNumber, subcontractor.name);
        };

        return (
          <div className="min-h-screen flex items-center justify-center bg-gray-100">
            <div className="max-w-md w-full bg-white rounded-lg shadow-md p-6">
              <div className="text-center mb-8">
                <h1 className="text-2xl font-bold text-gray-800">
                  Alt Y√ºklenici Giri≈üi
                </h1>
                <p className="text-gray-600 mt-2">
                  L√ºtfen alt y√ºklenici bilgilerinizi giriniz
                </p>
              </div>

              <form onSubmit={handleLogin} className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Alt Y√ºklenici No
                  </label>
                  <select
                    value={subcontractorNumber}
                    onChange={(e) => {
                      setSubcontractorNumber(e.target.value);
                      setError("");
                      if (e.target.value && subcontractors[e.target.value]) {
                        setPassword(subcontractors[e.target.value].password);
                      }
                    }}
                    className={selectStyles}
                  >
                    <option value="">Se√ßiniz</option>
                    {Object.keys(subcontractors).map((number) => (
                      <option key={number} value={number}>
                        {number}
                      </option>
                    ))}
                  </select>
                </div>

                {subcontractorNumber && subcontractors[subcontractorNumber] && (
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <p className="text-blue-700 text-sm">
                      Alt Y√ºklenici:{" "}
                      <span className="font-medium">
                        {subcontractors[subcontractorNumber].name}
                      </span>
                    </p>
                  </div>
                )}

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    ≈ûifre
                  </label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => {
                      setPassword(e.target.value);
                      setError("");
                    }}
                    className={inputStyles}
                    placeholder="≈ûifrenizi giriniz"
                  />
                </div>

                {error && (
                  <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                    {" "}
                    <p className="text-red-700 text-sm">{error}</p>{" "}
                  </div>
                )}

                <button
                  type="submit"
                  className={`${buttonStyles.primary} w-full`}
                >
                  Giri≈ü Yap
                </button>
              </form>
            </div>
          </div>
        );
      }

      // Saha Ekipman Raporu Bile≈üeni
      function EquipmentReportForm({
        date,
        shift,
        onDateChange,
        onShiftChange,
        excelData,
        currentSubcontractor,
      }) {
        const [equipmentList, setEquipmentList] = React.useState([]);
        const [currentEquipment, setCurrentEquipment] = React.useState({
          plate: "",
          equipmentName: "",
          capacity: "",
          operator: "",
          status: "",
        });
        const [editingId, setEditingId] = React.useState(null);
        const [errors, setErrors] = React.useState({});
        const [generalNotes, setGeneralNotes] = React.useState("");
        // G√∂sterilecek √∂neri dropdown'larƒ± i√ßin state
        const [showPlateSuggestions, setShowPlateSuggestions] =
          React.useState(false);
        const [showOperatorSuggestions, setShowOperatorSuggestions] =
          React.useState(false);

        // Equipment sheet'inden verileri al
        const equipmentData = React.useMemo(() => {
          if (!excelData || !excelData["Equipment"]) return [];

          const sheetData = excelData["Equipment"];
          if (sheetData.length < 2) return [];

          const headers = sheetData[0];
          const indices = {
            no: headers.indexOf("No"),
            name: headers.indexOf("Name"),
            description: headers.indexOf("Description"),
            capacity: headers.indexOf("Capacity_Size"),
            plate: headers.indexOf("Plate_Number"),
            operator: headers.indexOf("Operator"),
            status: headers.indexOf("Status"),
            owner: headers.indexOf("Owner"),
            maintenance: headers.indexOf("Maintenance_Date"),
            note: headers.indexOf("Note"),
          };

          const data = [];
          for (let i = 1; i < sheetData.length; i++) {
            const row = sheetData[i];
            if (row.length === 0) continue;

            data.push({
              no: row[indices.no],
              name: row[indices.name],
              description: row[indices.description],
              capacity: row[indices.capacity],
              plate: row[indices.plate],
              operator: row[indices.operator],
              status: row[indices.status],
              owner: row[indices.owner],
              maintenance: row[indices.maintenance],
              note: row[indices.note],
            });
          }
          return data;
        }, [excelData]);

        // Benzersiz plaka numaralarƒ±
        const uniquePlates = React.useMemo(() => {
          const plates = equipmentData
            .map((item) => item.plate)
            .filter(Boolean);
          return [...new Set(plates)];
        }, [equipmentData]);

        // Benzersiz operat√∂rler
        const uniqueOperators = React.useMemo(() => {
          const operators = equipmentData
            .map((item) => item.operator)
            .filter(Boolean);
          return [...new Set(operators)];
        }, [equipmentData]);

        // Plaka se√ßildiƒüinde otomatik doldur
        const handlePlateSelect = (plateNumber) => {
          const equipment = equipmentData.find(
            (item) => item.plate === plateNumber,
          );
          if (equipment) {
            setCurrentEquipment((prev) => ({
              ...prev,
              plate: plateNumber,
              equipmentName: equipment.name || "",
              capacity: equipment.capacity || "",
              status: equipment.status || "",
            }));
          }
        };

        // Operat√∂r se√ßildiƒüinde otomatik doldur
        const handleOperatorSelect = (operator) => {
          setCurrentEquipment((prev) => ({
            ...prev,
            operator: operator,
          }));
        };

        // Form doƒürulama
        const validateForm = () => {
          const newErrors = {};

          if (!currentEquipment.plate) newErrors.plate = "Bir Plaka Giriniz";
          if (!currentEquipment.operator)
            newErrors.operator = "Bir Operat√∂r Giriniz";
          if (currentEquipment.status !== "√áalƒ±≈üƒ±yor") {
            newErrors.status = `Se√ßilen Ekipman ${currentEquipment.status}`;
          }

          return newErrors;
        };

        // Ekle/G√ºncelle butonu
        const handleAdd = () => {
          const validationErrors = validateForm();

          if (Object.keys(validationErrors).length > 0) {
            setErrors(validationErrors);
            return;
          }

          const newItem = {
            id: editingId || Date.now(),
            plate: currentEquipment.plate,
            equipmentName: currentEquipment.equipmentName,
            capacity: currentEquipment.capacity,
            operator: currentEquipment.operator,
            status: currentEquipment.status,
          };

          if (editingId) {
            setEquipmentList(
              equipmentList.map((item) =>
                item.id === editingId ? newItem : item,
              ),
            );
            setEditingId(null);
          } else {
            setEquipmentList([...equipmentList, newItem]);
          }

          // Formu temizle
          setCurrentEquipment({
            plate: "",
            equipmentName: "",
            capacity: "",
            operator: "",
            status: "",
          });
          setErrors({});
        };

        // D√ºzenle butonu
        const handleEdit = (id) => {
          const item = equipmentList.find((item) => item.id === id);
          if (item) {
            setCurrentEquipment({
              plate: item.plate,
              equipmentName: item.equipmentName,
              capacity: item.capacity,
              operator: item.operator,
              status: item.status,
            });
            setEditingId(id);
          }
        };

        // Sil butonu
        const handleDelete = (id) => {
          setEquipmentList(equipmentList.filter((item) => item.id !== id));
        };

        // ƒ∞ptal butonu
        const handleCancelEdit = () => {
          setCurrentEquipment({
            plate: "",
            equipmentName: "",
            capacity: "",
            operator: "",
            status: "",
          });
          setEditingId(null);
          setErrors({});
        };

        // Ekipman kartƒ± g√∂r√ºnt√ºleme
        const [showEquipmentCard, setShowEquipmentCard] = React.useState(false);
        const [selectedEquipment, setSelectedEquipment] = React.useState(null);

        const handleShowEquipmentCard = (equipment) => {
          const fullEquipmentData = equipmentData.find(
            (item) => item.plate === equipment.plate,
          );
          setSelectedEquipment(fullEquipmentData);
          setShowEquipmentCard(true);
        };

        // Filtrelenmi≈ü plaka listesi (zaten eklenmi≈ü olanlar hari√ß)
        const availablePlates = uniquePlates.filter(
          (plate) => !equipmentList.some((item) => item.plate === plate),
        );

        return (
          <div className="space-y-6">
            <div className="section">
              <div className="form-rows">
                {/* 1. Satƒ±r */}
                <div
                  style={{
                    display: "grid",
                    gridTemplateColumns: "30% 40% 30%",
                    gap: "1rem",
                    marginBottom: "1rem",
                  }}
                >
                  <div className="form-group" style={{ position: "relative" }}>
                    <label className="form-label">Plaka Giriniz</label>
                    <input
                      value={currentEquipment.plate}
                      onChange={(e) => {
                        setCurrentEquipment((prev) => ({
                          ...prev,
                          plate: e.target.value,
                        }));
                        setErrors({ ...errors, plate: "" });
                        setShowPlateSuggestions(true);
                      }}
                      onFocus={() => setShowPlateSuggestions(true)}
                      onBlur={() =>
                        setTimeout(() => {
                          setShowPlateSuggestions(false);
                          handlePlateSelect(currentEquipment.plate);
                        }, 150)
                      }
                      className={inputStyles}
                      placeholder="Plaka se√ßin veya yazƒ±n"
                    />
                    {showPlateSuggestions &&
                      availablePlates
                        .filter(
                          (p) =>
                            !equipmentList.some((item) => item.plate === p),
                        )
                        .filter((p) => {
                          if (!currentEquipment.plate) return true;
                          return String(p)
                            .toLowerCase()
                            .includes(
                              String(currentEquipment.plate).toLowerCase(),
                            );
                        }).length > 0 && (
                        <div className="suggestions-list">
                          {availablePlates
                            .filter(
                              (p) =>
                                !equipmentList.some((item) => item.plate === p),
                            )
                            .filter((p) => {
                              if (!currentEquipment.plate) return true;
                              return String(p)
                                .toLowerCase()
                                .includes(
                                  String(currentEquipment.plate).toLowerCase(),
                                );
                            })
                            .map((plate, idx) => (
                              <div
                                key={idx}
                                className="suggestion-item"
                                onMouseDown={(e) => {
                                  e.preventDefault();
                                  setCurrentEquipment((prev) => ({
                                    ...prev,
                                    plate: plate,
                                  }));
                                  setShowPlateSuggestions(false);
                                  handlePlateSelect(plate);
                                }}
                              >
                                {plate}
                              </div>
                            ))}
                        </div>
                      )}
                    {errors.plate && (
                      <div className="text-red-500 text-xs mt-1">
                        {errors.plate}
                      </div>
                    )}
                  </div>

                  <div className="form-group">
                    <label className="form-label">Ekipman Adƒ±</label>
                    <input
                      value={currentEquipment.equipmentName}
                      readOnly
                      className={inputStyles}
                    />
                  </div>

                  <div className="form-group">
                    <label className="form-label">Kapasite-√ñl√ß√º</label>
                    <input
                      value={currentEquipment.capacity}
                      readOnly
                      className={inputStyles}
                    />
                  </div>
                </div>

                {/* 2. Satƒ±r */}
                <div
                  style={{
                    display: "grid",
                    gridTemplateColumns: "30% 40% 30%",
                    gap: "1rem",
                    marginBottom: "1rem",
                  }}
                >
                  <div className="form-group" style={{ position: "relative" }}>
                    <label className="form-label">Operat√∂r Giriniz</label>
                    <input
                      value={currentEquipment.operator}
                      onChange={(e) => {
                        setCurrentEquipment((prev) => ({
                          ...prev,
                          operator: e.target.value,
                        }));
                        setErrors({ ...errors, operator: "" });
                        setShowOperatorSuggestions(true);
                      }}
                      onFocus={() => setShowOperatorSuggestions(true)}
                      onBlur={() =>
                        setTimeout(() => {
                          setShowOperatorSuggestions(false);
                          handleOperatorSelect(currentEquipment.operator);
                        }, 150)
                      }
                      className={inputStyles}
                      placeholder="Operat√∂r se√ßin veya yazƒ±n"
                    />
                    {showOperatorSuggestions &&
                      uniqueOperators.filter((op) => {
                        if (!currentEquipment.operator) return true;
                        return String(op)
                          .toLowerCase()
                          .includes(
                            String(currentEquipment.operator).toLowerCase(),
                          );
                      }).length > 0 && (
                        <div className="suggestions-list">
                          {uniqueOperators
                            .filter((op) => {
                              if (!currentEquipment.operator) return true;
                              return String(op)
                                .toLowerCase()
                                .includes(
                                  String(
                                    currentEquipment.operator,
                                  ).toLowerCase(),
                                );
                            })
                            .map((operator, idx) => (
                              <div
                                key={idx}
                                className="suggestion-item"
                                onMouseDown={(e) => {
                                  e.preventDefault();
                                  setCurrentEquipment((prev) => ({
                                    ...prev,
                                    operator: operator,
                                  }));
                                  setShowOperatorSuggestions(false);
                                  handleOperatorSelect(operator);
                                }}
                              >
                                {operator}
                              </div>
                            ))}
                        </div>
                      )}
                    {errors.operator && (
                      <div className="text-red-500 text-xs mt-1">
                        {errors.operator}
                      </div>
                    )}
                  </div>

                  <div className="form-group">
                    <label className="form-label">Durum</label>
                    <input
                      value={currentEquipment.status}
                      readOnly
                      className={inputStyles}
                    />
                  </div>

                  <div
                    className="form-group"
                    style={{
                      display: "flex",
                      flexDirection: "column",
                      justifyContent: "flex-end",
                    }}
                  >
                    {editingId ? (
                      <div style={{ display: "flex", gap: "0.5rem" }}>
                        <button
                          onClick={handleAdd}
                          className={buttonStyles.success}
                          style={{ flex: 1 }}
                        >
                          G√ºncelle
                        </button>
                        <button
                          onClick={handleCancelEdit}
                          className={buttonStyles.secondary}
                          style={{ flex: 1 }}
                        >
                          ƒ∞ptal
                        </button>
                      </div>
                    ) : (
                      <button
                        onClick={handleAdd}
                        className={buttonStyles.success}
                        style={{ width: "100%" }}
                      >
                        + Ekle {equipmentList.length + 1}.
                      </button>
                    )}
                    {errors.status && (
                      <div className="text-red-500 text-xs mt-1">
                        {errors.status}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>

            {/* Ekipman Listesi */}
            {equipmentList.length > 0 && (
              <div className="section">
                <h4 className="section-title">Eklenen Ekipmanlar</h4>
                <div className="manpower-table-container">
                  <table
                    className="data-table"
                    style={{ tableLayout: "fixed", width: "100%" }}
                  >
                    <thead>
                      <tr>
                        <th style={{ width: "15%" }}>Plaka</th>
                        <th style={{ width: "25%" }}>Ekipman Adƒ±</th>
                        <th style={{ width: "20%" }}>Kapasite-√ñl√ß√º</th>
                        <th style={{ width: "15%" }}>Operat√∂r</th>
                        <th style={{ width: "15%" }}>Ekipman Kartƒ±</th>
                        <th style={{ width: "10%" }}>ƒ∞≈ülem</th>
                      </tr>
                    </thead>
                    <tbody>
                      {equipmentList.map((item) => (
                        <tr key={item.id}>
                          <td>{item.plate}</td>
                          <td>{item.equipmentName}</td>
                          <td>{item.capacity}</td>
                          <td>{item.operator}</td>
                          <td>
                            <button
                              onClick={() => handleShowEquipmentCard(item)}
                              className={buttonStyles.primary}
                              style={{
                                padding: "0.3rem 0.6rem",
                                fontSize: "0.7rem",
                              }}
                            >
                              G√∂r√ºnt√ºle
                            </button>
                          </td>
                          <td>
                            <div
                              style={{
                                display: "flex",
                                flexDirection: "column",
                                gap: "0.2rem",
                              }}
                            >
                              <button
                                onClick={() => handleEdit(item.id)}
                                className={`${buttonStyles.edit} ${buttonStyles.small}`}
                                style={{
                                  padding: "0.2rem 0.4rem",
                                  fontSize: "0.65rem",
                                }}
                              >
                                D√ºzenle
                              </button>
                              <button
                                onClick={() => handleDelete(item.id)}
                                className={`${buttonStyles.danger} ${buttonStyles.small}`}
                                style={{
                                  padding: "0.2rem 0.4rem",
                                  fontSize: "0.65rem",
                                }}
                              >
                                Sil
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {/* Notlar B√∂l√ºm√º */}
            <div className="section">
              <h5 className="section-title">Notlar</h5>
              <textarea
                value={generalNotes}
                onChange={(e) => setGeneralNotes(e.target.value)}
                placeholder="Notlarƒ± buraya giriniz"
                className="form-textarea h-24"
              />
            </div>

            {/* Kaydet ve Temizle Butonlarƒ± */}
            <div className="flex space-x-4">
              <button className={buttonStyles.primary}>Raporu Kaydet</button>
              <button className={buttonStyles.secondary}>Formu Temizle</button>
            </div>

            {/* Ekipman Kartƒ± Modal */}
            {showEquipmentCard && selectedEquipment && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] overflow-y-auto">
                  <div className="flex justify-between items-center p-4 border-b">
                    <h2 className="text-xl font-semibold">Ekipman Kartƒ±</h2>
                    <button
                      onClick={() => setShowEquipmentCard(false)}
                      className="text-gray-500 hover:text-gray-700 text-2xl"
                    >
                      √ó
                    </button>
                  </div>
                  <div className="p-6">
                    <p className="text-center text-gray-500 py-8">
                      Ekipman Kartƒ± daha sonra tasarlanacaktƒ±r
                    </p>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      // T√ºm Raporlar Bile≈üeni
      function AllReportsView({ allReports, currentSubcontractor }) {
        return (
          <div className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div className="space-y-4">
                <h3 className="text-lg font-semibold text-green-700">
                  G√ºnl√ºk Raporlar
                </h3>
                <div className="border rounded-lg">
                  <div className="bg-gray-100 px-4 py-3 font-semibold border-b cursor-pointer flex justify-between items-center">
                    <span>1. Hafta - 01.01.2023 ‚Äì 07.01.2023</span>
                    <span>‚ñº</span>
                  </div>
                </div>
                <p className="text-gray-500 text-center py-8">
                  Hen√ºz rapor bulunmamaktadƒ±r.
                </p>
              </div>

              <div className="space-y-4">
                <h3 className="text-lg font-semibold text-blue-700">
                  Manpower Raporlarƒ±
                </h3>
                <div className="border rounded-lg">
                  <div className="bg-gray-100 px-4 py-3 font-semibold border-b cursor-pointer flex justify-between items-center">
                    <span>1. Hafta - 01.01.2023 ‚Äì 07.01.2023</span>
                    <span>‚ñº</span>
                  </div>
                </div>
                <p className="text-gray-500 text-center py-8">
                  Hen√ºz manpower raporu bulunmamaktadƒ±r.
                </p>
              </div>
            </div>
          </div>
        );
      }

      //  SIDEBAR Bƒ∞LE≈ûENƒ∞
      function NewSidebar({
        selectedMain,
        setSelectedMain,
        selectedSub,
        setSelectedSub,
        currentSubcontractor,
        handleLogout,
      }) {
        const [activeSections, setActiveSections] = React.useState({});

        const menuIcons = {
          Raporlar: "üìä",
          Projeler: "üèóÔ∏è",
          D√∂k√ºmanlar: "üìã",
          Malzeme: "üì¶",
          "Kalite Kontrol": "‚úÖ",
          Fotoƒüraflar: "üì∑",
          Hakedi≈üler: "üìÅ",
          MT8: "‚öôÔ∏è",
          MT9: "üî©",
          MT10: "üõ†Ô∏è",
        };

        const toggleSection = (sectionName) => {
          setActiveSections((prev) => ({
            ...prev,
            [sectionName]: !prev[sectionName],
          }));
        };

        const handleSectionClick = (mt) => {
          if (activeSections[mt.name]) {
            // Eƒüer zaten a√ßƒ±ksa, kapat
            setActiveSections((prev) => ({
              ...prev,
              [mt.name]: false,
            }));
          } else {
            // A√ßƒ±k olan diƒüer t√ºm b√∂l√ºmleri kapat
            const newActiveSections = {};
            newActiveSections[mt.name] = true;
            setActiveSections(newActiveSections);
            setSelectedMain(mt.name);
            setSelectedSub(mt.subs[0]);
          }
        };

        return (
          <div className="sidebar-content p-3 overflow-y-auto">
            <div className="sidebar-logo-area">
              <div className="sidebar-logo">
                <span>üè≠</span>
                <span>End√ºstri Pro</span>
              </div>
              <div className="sidebar-subtitle">Alt Y√ºklenici Paneli</div>
              <div className="text-xs mt-1">
                <p>{currentSubcontractor.name}</p>
                <p>{currentSubcontractor.number}</p>
              </div>
              <button
                onClick={handleLogout}
                className="mt-1 text-xs text-red-600 hover:text-red-800"
              >
                √áƒ±kƒ±≈ü Yap
              </button>
            </div>

            {menuStructure.map((mt) => (
              <div key={mt.name} className="sidebar-menu-section">
                <div
                  className={`sidebar-section-header ${activeSections[mt.name] ? "active" : ""}`}
                  onClick={() => handleSectionClick(mt)}
                >
                  <div className="sidebar-section-icon">
                    <span>{menuIcons[mt.name] || "üìÅ"}</span>
                    <span>{mt.name}</span>
                  </div>
                  <span className="sidebar-section-arrow">‚ñº</span>
                </div>
                <div
                  className={`sidebar-section-content ${activeSections[mt.name] ? "active" : ""}`}
                >
                  {mt.subs.map((st) => (
                    <div
                      key={st}
                      className={`sidebar-menu-item ${selectedSub === st ? "active" : ""}`}
                      onClick={() => setSelectedSub(st)}
                    >
                      <span className="sidebar-menu-icon">‚Üí</span>
                      <span>{st}</span>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        );
      }

      // Ana APP Bile≈üeni
      function App() {
        const [isLoggedIn, setIsLoggedIn] = React.useState(false);
        const [currentSubcontractor, setCurrentSubcontractor] = React.useState({
          number: "",
          name: "",
        });
        const [selectedProject, setSelectedProject] = React.useState("");

        const [selectedMain, setSelectedMain] = React.useState(
          menuStructure[0].name,
        );
        const [selectedSub, setSelectedSub] = React.useState(
          menuStructure[0].subs[0],
        );
        const [date, setDate] = React.useState(
          () => new Date().toISOString().split("T")[0],
        );
        const [shift, setShift] = React.useState("");

        // Kategori state'leri
        const [mainCategory, setMainCategory] = React.useState("");
        const [subCategory, setSubCategory] = React.useState("");
        const [mechanicalDetail, setMechanicalDetail] = React.useState("");
        const [mechanicalDetail2, setMechanicalDetail2] = React.useState("");
        const [eiDetail1, setEiDetail1] = React.useState("");
        const [eiDetail2, setEiDetail2] = React.useState("");

        // Yeni form state'leri
        const [currentCable, setCurrentCable] = React.useState({
          tag: "",
          cableType: "",
          size: "",
          from: "",
          to: "",
          designLength: "",
          unit: "m",
          actualLength: "",
          drumNumber: "",
          primarySecondary: "",
          start: "",
          finish: "",
          allowDifferentDrum: false,
          differentDrum: "",
          notes: "",
          drawingNumber: "",
          revision: "",
        });

        // Excel verileri state'i
        const [excelData, setExcelData] = React.useState(null);
        const [filteredCableTags, setFilteredCableTags] = React.useState([]);
        const [cableTagInput, setCableTagInput] = React.useState("");
        const [showCableTagSuggestions, setShowCableTagSuggestions] =
          React.useState(false);
        const [alternativeDrums, setAlternativeDrums] = React.useState([]);

        // Terminasyon form state'i
        const [currentTerminationCable, setCurrentTerminationCable] =
          React.useState({
            tag: "",
            cableType: "",
            size: "",
            from: "",
            to: "",
            fromTerminated: false,
            toTerminated: false,
            fromPreviouslyTerminated: false,
            toPreviouslyTerminated: false,
            notes: "",
          });

        // Kablo √áekimi i√ßin state'ler
        const [cableList, setCableList] = React.useState([]);
        const [editingCableId, setEditingCableId] = React.useState(null);
        const [cableErrors, setCableErrors] = React.useState({});

        // Genel notlar state'i
        const [generalNotes, setGeneralNotes] = React.useState("");

        // Cable Schedule modal state'i
        const [showCableSchedule, setShowCableSchedule] = React.useState(false);

        // Yan men√º state'i
        const [sidebarOpen, setSidebarOpen] = React.useState(true);

        const handleLogin = (subcontractorNumber, subcontractorName) => {
          setCurrentSubcontractor({
            number: subcontractorNumber,
            name: subcontractorName,
          });
          setIsLoggedIn(true);
        };

        const handleProjectSelect = (projectId) => {
          setSelectedProject(projectId);
        };

        const handleLogout = () => {
          setIsLoggedIn(false);
          setCurrentSubcontractor({ number: "", name: "" });
          setSelectedProject("");
          setSelectedMain(menuStructure[0].name);
          setSelectedSub(menuStructure[0].subs[0]);
          setMainCategory("");
          setSubCategory("");
          setShift("");
          setExcelData(null);
        };

        // Ana kategori deƒüi≈üince alt kategoriyi sƒ±fƒ±rla
        React.useEffect(() => {
          setSubCategory("");
          setMechanicalDetail("");
          setMechanicalDetail2("");
          setEiDetail1("");
          setEiDetail2("");
        }, [mainCategory]);

        // Alt kategori deƒüi≈ütiƒüinde Detay-2'yi sƒ±fƒ±rla
        React.useEffect(() => {
          if (subCategory) {
            if (mainCategory === "Elektrik ve Enstruman") {
              setEiDetail2("");
            }
          }
        }, [subCategory, mainCategory]);

        // Excel verileri y√ºklendiƒüinde √ßaƒürƒ±lƒ±r
        const handleExcelDataLoaded = (data) => {
          setExcelData(data);
        };

        // Detay-1 deƒüi≈ütiƒüinde cable tag'leri filtrele
        React.useEffect(() => {
          if (!excelData || !eiDetail1) return;

          const sheetNameMap = {
            Elektrik: "Electrical",
            Enstr√ºman: "Instrumentation",
            Telekom: "Telecom",
          };

          const sheetName = sheetNameMap[eiDetail1];
          if (!sheetName || !excelData[sheetName]) {
            setFilteredCableTags([]);
            return;
          }

          const sheetData = excelData[sheetName];
          if (sheetData.length < 2) {
            setFilteredCableTags([]);
            return;
          }

          // Ba≈ülƒ±klarƒ± bul
          const headers = sheetData[0];
          const cableTagIndex = headers.indexOf("Cable_Tag");
          const statusIndex = headers.indexOf("Status");

          // Status 0, 5, 7 olan kayƒ±tlarƒ± filtrele
          const filtered = [];
          for (let i = 1; i < sheetData.length; i++) {
            const row = sheetData[i];
            if (
              row[statusIndex] === 0 ||
              row[statusIndex] === 5 ||
              row[statusIndex] === 7
            ) {
              filtered.push(row[cableTagIndex]);
            }
          }

          setFilteredCableTags(filtered);
          // Eƒüer mevcut input artƒ±k filtrelenmi≈ü listede yoksa temizle
          setCableTagInput((prev) => (filtered.includes(prev) ? prev : ""));
        }, [excelData, eiDetail1]);

        // Cable tag se√ßildiƒüinde otomatik doldur
        const handleCableTagSelect = (cableTag) => {
          if (!excelData || !eiDetail1) return;

          const sheetNameMap = {
            Elektrik: "Electrical",
            Enstr√ºman: "Instrumentation",
            Telekom: "Telecom",
          };

          const sheetName = sheetNameMap[eiDetail1];
          if (!sheetName || !excelData[sheetName]) return;

          const sheetData = excelData[sheetName];

          // Ba≈ülƒ±klarƒ± bul
          const headers = sheetData[0];
          const cableTagIndex = headers.indexOf("Cable_Tag");
          const cableTypeIndex = headers.indexOf("Cable_Type");
          const cableSizeIndex = headers.indexOf("Cable_Size");
          const fromIndex = headers.indexOf("From_Source");
          const toIndex = headers.indexOf("To_User");
          const designLengthIndex = headers.indexOf("Design_Length");
          const drumNumberIndex = headers.indexOf("Drum_Number");
          const primarySecondaryIndex = headers.indexOf("Primary_Secondary");
          const drawingNoIndex = headers.indexOf("Drawing_No");
          const revisionIndex = headers.indexOf("Revision");

          // Tag'i bul
          for (let i = 1; i < sheetData.length; i++) {
            const row = sheetData[i];
            if (row.length === 0) continue;

            if (row[cableTagIndex] === cableTag) {
              setCurrentCable((prev) => ({
                ...prev,
                tag: row[cableTagIndex],
                cableType: row[cableTypeIndex],
                size: row[cableSizeIndex],
                from: row[fromIndex],
                to: row[toIndex],
                designLength: row[designLengthIndex]
                  ? parseFloat(row[designLengthIndex])
                      .toFixed(2)
                      .replace(".", ",")
                  : "",
                drumNumber: row[drumNumberIndex],
                primarySecondary: row[primarySecondaryIndex],
                drawingNumber: row[drawingNoIndex],
                revision: row[revisionIndex],

                // Se√ßim deƒüi≈ütiƒüinde hesaplama alanlarƒ±nƒ± sƒ±fƒ±rla
                start: "",
                finish: "",
                actualLength: "",
                allowDifferentDrum: false,
                differentDrum: "",
              }));

              // kullanƒ±cƒ± aray√ºz√ºndeki input deƒüerini g√ºncelle
              setCableTagInput(row[cableTagIndex] || "");

              //  Excel'den gelen Primary_Secondary verisini Detay-2'ye ata
              if (
                subCategory === "Kablo √áekimi" ||
                subCategory === "Kablo Baƒülantƒ±larƒ±"
              ) {
                setEiDetail2(row[primarySecondaryIndex] || "-");
              }

              // Alternatif drum numaralarƒ±nƒ± bul
              findAlternativeDrums(
                row[cableTypeIndex],
                row[cableSizeIndex],
                row[drumNumberIndex],
              );
              break;
            }
          }
        };

        // Kullanƒ±cƒ±nƒ±n input ile yazdƒ±ƒüƒ± deƒüeri doƒürula (blur veya submit √∂ncesi)
        const validateCableTagInput = () => {
          // Eƒüer bo≈üsa alanƒ± temizle
          if (!cableTagInput) {
            setCurrentCable({
              tag: "",
              cableType: "",
              size: "",
              from: "",
              to: "",
              designLength: "",
              unit: "m",
              actualLength: "",
              drumNumber: "",
              start: "",
              finish: "",
              allowDifferentDrum: false,
              differentDrum: "",
              notes: "",
              drawingNumber: "",
              revision: "",
            });
            if (
              subCategory === "Kablo √áekimi" ||
              subCategory === "Kablo Baƒülantƒ±larƒ±"
            ) {
              setEiDetail2("");
            }
            return;
          }

          // Girilen deƒüer filtrelenmi≈ü kablolar i√ßinde deƒüilse temizle
          if (!filteredCableTags.includes(cableTagInput)) {
            // Ge√ßersiz giri≈ü: temizle
            setCableTagInput("");
            setCurrentCable({
              tag: "",
              cableType: "",
              size: "",
              from: "",
              to: "",
              designLength: "",
              unit: "m",
              actualLength: "",
              drumNumber: "",
              start: "",
              finish: "",
              allowDifferentDrum: false,
              differentDrum: "",
              notes: "",
              drawingNumber: "",
              revision: "",
            });
            if (
              subCategory === "Kablo √áekimi" ||
              subCategory === "Kablo Baƒülantƒ±larƒ±"
            ) {
              setEiDetail2("");
            }
            return;
          }

          // Eƒüer listede varsa, se√ßilmi≈ü gibi i≈üle
          handleCableTagSelect(cableTagInput);
        };

        // Alternatif drum numaralarƒ±nƒ± bul
        const findAlternativeDrums = (cableType, cableSize, currentDrum) => {
          if (!excelData || !eiDetail1) {
            setAlternativeDrums([]);
            return;
          }

          const sheetNameMap = {
            Elektrik: "Electrical",
            Enstr√ºman: "Instrumentation",
            Telekom: "Telecom",
          };

          const sheetName = sheetNameMap[eiDetail1];
          if (!sheetName || !excelData[sheetName]) {
            setAlternativeDrums([]);
            return;
          }

          const sheetData = excelData[sheetName];
          const headers = sheetData[0];
          const cableTypeIndex = headers.indexOf("Cable_Type");
          const cableSizeIndex = headers.indexOf("Cable_Size");
          const drumNumberIndex = headers.indexOf("Drum_Number");
          const statusIndex = headers.indexOf("Status");

          const alternativeDrumsSet = new Set();

          for (let i = 1; i < sheetData.length; i++) {
            const row = sheetData[i];
            if (
              row[cableTypeIndex] === cableType &&
              row[cableSizeIndex] === cableSize &&
              row[drumNumberIndex] !== currentDrum &&
              (row[statusIndex] === 0 ||
                row[statusIndex] === 5 ||
                row[statusIndex] === 7)
            ) {
              alternativeDrumsSet.add(row[drumNumberIndex]);
            }
          }

          setAlternativeDrums(Array.from(alternativeDrumsSet));
        };

        // Yardƒ±mcƒ±: Form alanlarƒ±nda g√∂sterilecek sayƒ±yƒ± iki ondalƒ±k ve virg√ºl ile formatla
        const formatDisplayNumberInCableForm = (val) => {
          if (val === null || val === undefined || val === "") return "";
          // string olarak al, virg√ºl√º ondalƒ±k i≈üareti olarak kabul et
          let str = String(val).trim();
          // Eƒüer kullanƒ±cƒ± nokta/virg√ºl kullandƒ±ysa normalize et
          str = str.replace(/\s+/g, "").replace(",", ".");
          const num = Number(str);
          if (Number.isNaN(num)) return String(val);
          // G√∂sterimde virg√ºl kullan
          return num.toFixed(2).replace(".", ",");
        };

        // Farklƒ± makara checkbox'ƒ± deƒüi≈ütiƒüinde
        const handleDifferentDrumChange = (e) => {
          const isChecked = e.target.checked;
          setCurrentCable((prev) => ({
            ...prev,
            allowDifferentDrum: isChecked,
            differentDrum: isChecked ? prev.differentDrum : "",
          }));
        };

        // Farklƒ± makara numarasƒ± deƒüi≈ütiƒüinde
        const handleDifferentDrumSelect = (drumNumber) => {
          setCurrentCable((prev) => ({
            ...prev,
            differentDrum: drumNumber,
          }));
        };

        // Kablo √áekimi fonksiyonlarƒ±
        const validateCableForm = () => {
          const newErrors = {};

          if (!currentCable.tag) newErrors.tag = "Ge√ßerli bir kablo se√ßiniz";
          if (!currentCable.start)
            newErrors.start = "Makara ba≈ülangƒ±√ß deƒüerini giriniz";
          if (!currentCable.finish)
            newErrors.finish = "Makara biti≈ü deƒüerini giriniz";

          return newErrors;
        };

        const handleAddCable = () => {
          const validationErrors = validateCableForm();

          if (Object.keys(validationErrors).length > 0) {
            setCableErrors(validationErrors);
            return;
          }

          if (cableList.length >= 10 && !editingCableId) {
            alert("Maksimum 10 kablo ekleyebilirsiniz");
            return;
          }

          // Aynƒ± kablo kontrol√º
          if (
            !editingCableId &&
            cableList.some((cable) => cable.tag === currentCable.tag)
          ) {
            alert("Bu kablo zaten listede mevcut");
            return;
          }

          // Start/Finish'i tutarlƒ± bi√ßimde formatla (2 ondalƒ±k, virg√ºl)
          const formattedStart = formatDisplayNumberInCableForm(
            currentCable.start,
          );
          const formattedFinish = formatDisplayNumberInCableForm(
            currentCable.finish,
          );

          const cableData = {
            id: editingCableId || Date.now(),
            tag: currentCable.tag,
            cableType: currentCable.cableType,
            size: currentCable.size,
            from: currentCable.from,
            to: currentCable.to,
            designLength: currentCable.designLength,
            actualLength: currentCable.actualLength,
            start: formattedStart,
            finish: formattedFinish,
            drumNumber: currentCable.allowDifferentDrum
              ? currentCable.differentDrum
              : currentCable.drumNumber,
            drawingNumber: currentCable.drawingNumber,
            revision: currentCable.revision,
            notes: currentCable.notes,
          };

          if (editingCableId) {
            setCableList(
              cableList.map((cable) =>
                cable.id === editingCableId ? cableData : cable,
              ),
            );
            setEditingCableId(null);
          } else {
            setCableList([...cableList, cableData]);
          }

          resetCableForm();
        };

        const handleEditCable = (id) => {
          const cable = cableList.find((item) => item.id === id);
          if (cable) {
            setCurrentCable({
              ...cable,
              // Ensure start/finish shown with two decimals when editing
              start: formatDisplayNumberInCableForm(cable.start),
              finish: formatDisplayNumberInCableForm(cable.finish),
              allowDifferentDrum: false,
              differentDrum: cable.drumNumber,
            });
            setCableTagInput(cable.tag);
            setEditingCableId(id);
          }
        };

        const handleDeleteCable = (id) => {
          setCableList(cableList.filter((cable) => cable.id !== id));
        };

        const handleCancelEdit = () => {
          setEditingCableId(null);
          resetCableForm();
        };

        const resetCableForm = () => {
          setCurrentCable({
            tag: "",
            cableType: "",
            size: "",
            from: "",
            to: "",
            designLength: "",
            unit: "m",
            actualLength: "",
            drumNumber: "",
            start: "",
            finish: "",
            allowDifferentDrum: false,
            differentDrum: "",
            notes: "",
            drawingNumber: "",
            revision: "",
          });
          setCableTagInput("");
          setCableErrors({});
        };

        // Cable Tag listesini filtrele (listede olmayanlarƒ± g√∂ster)
        const availableCableTags = filteredCableTags.filter(
          (tag) => !cableList.some((cable) => cable.tag === tag),
        );

        // Start ve Finish deƒüi≈ütiƒüinde Actual Length hesapla
        React.useEffect(() => {
          const start =
            parseFloat(String(currentCable.start).replace(",", ".")) || 0;
          const finish =
            parseFloat(String(currentCable.finish).replace(",", ".")) || 0;
          const actualLength = Math.abs(finish - start);

          setCurrentCable((prev) => ({
            ...prev,
            actualLength: !isNaN(actualLength)
              ? actualLength.toFixed(2).replace(".", ",")
              : "",
          }));
        }, [currentCable.start, currentCable.finish]);

        // Eƒüer excel'den gelen Primary/Secondary deƒüeri varsa, Kablo √áekimi / Baƒülantƒ±larƒ± i√ßin
        // Detay-2'yi (eiDetail2) otomatik olarak doldur.
        React.useEffect(() => {
          if (
            (subCategory === "Kablo √áekimi" ||
              subCategory === "Kablo Baƒülantƒ±larƒ±") &&
            currentCable.primarySecondary
          ) {
            setEiDetail2(currentCable.primarySecondary || "-");
          }
        }, [currentCable.primarySecondary, subCategory]);

        // Alt kategori deƒüi≈üince current cable'ƒ± sƒ±fƒ±rla
        React.useEffect(() => {
          setCurrentCable({
            tag: "",
            cableType: "",
            size: "",
            from: "",
            to: "",
            designLength: "",
            unit: "m",
            actualLength: "",
            drumNumber: "",
            start: "",
            finish: "",
            allowDifferentDrum: false,
            differentDrum: "",
            notes: "",
            drawingNumber: "",
            revision: "",
          });
          setCurrentTerminationCable({
            tag: "",
            cableType: "",
            size: "",
            from: "",
            to: "",
            fromTerminated: false,
            toTerminated: false,
            fromPreviouslyTerminated: false,
            toPreviouslyTerminated: false,
            notes: "",
          });
          setGeneralNotes("");
        }, [subCategory]);

        const isReportForm =
          selectedMain === "Raporlar" && selectedSub === "Rapor Giri≈ü";
        const isManpowerForm =
          selectedMain === "Raporlar" && selectedSub === "√áalƒ±≈üan Saha Raporu";
        const isAllReports =
          selectedMain === "Raporlar" && selectedSub === "T√ºm Raporlar";
        const isRFIForm =
          selectedMain === "Kalite Kontrol" &&
          selectedSub === "ƒ∞malat Kontrol Talebi (RFI)";
        const isNCRForm =
          selectedMain === "Kalite Kontrol" &&
          selectedSub === "Uygunsuzluk Raporlarƒ± (NCR) ";
        const isEquipmentReport =
          selectedMain === "Raporlar" && selectedSub === "Saha Ekipman Raporu";

        const isCablePulling = subCategory && subCategory === "Kablo √áekimi";
        const isCableTermination =
          subCategory && subCategory === "Kablo Baƒülantƒ±larƒ±";
        const isCableTray =
          subCategory && subCategory === "Kablo Kanalƒ± (Tavasƒ±) Montajƒ±";

        const isMechanicalWithDetails =
          mainCategory === "Mekanik" && mechanicalSubCategories[subCategory];
        const isEIWithDetails =
          mainCategory === "Elektrik ve Enstruman" &&
          eiDetailOptions[subCategory];

        // Isƒ±tma Sistemleri Cihaz Montajƒ± formunu kontrol et
        const isHeatingDeviceForm =
          mainCategory === "Mekanik" &&
          subCategory === "Radyat√∂r Demo" &&
          mechanicalDetail === "Isƒ±tƒ±cƒ± Montajƒ±";

          // YENƒ∞: Mekanik Rapor Formu ko≈üulu - "Ekstra ƒ∞≈üler" ve "Radyat√∂r Demo" hari√ß t√ºm Mekanik alt kategorileri
const isMechanicalReportForm =
  mainCategory === "Mekanik" &&
  subCategory !== "Ekstra ƒ∞≈üler" &&
  subCategory !== "Radyat√∂r Demo" &&
  mechanicalDetail;
  // mechanicalDetail2 ≈üartƒ± kaldƒ±rƒ±ldƒ± - Detay-2 "-" olsa bile form a√ßƒ±lsƒ±n

        // Kategori ba≈ülƒ±ƒüƒ±nƒ± formatla
        const getCategoryTitle = () => {
          if (isEIWithDetails && eiDetail1) {
            // Kablo Kanalƒ± i√ßin Detay-2'yi de ekle
            if (subCategory === "Kablo Kanalƒ± (Tavasƒ±) Montajƒ±" && eiDetail2) {
              return `${eiDetail1} ${eiDetail2} ${subCategory}`;
            }
            // Kablo √áekimi ve Baƒülantƒ±larƒ± i√ßin sadece Detay-1 ve kategori adƒ±
            if (
              subCategory === "Kablo √áekimi" ||
              subCategory === "Kablo Baƒülantƒ±larƒ±"
            ) {
              return `${eiDetail1} ${subCategory}`;
            }
            // Diƒüer kategoriler i√ßin sadece Detay-1
            return `${eiDetail1} ${subCategory}`;
          }
          return subCategory;
        };

        if (!isLoggedIn) {
          return <LoginScreen onLogin={handleLogin} />;
        }

        if (!selectedProject) {
          return <ProjectSelector onProjectSelect={handleProjectSelect} />;
        }

        return (
          <div
            className={`flex h-screen ${sidebarOpen ? "" : "sidebar-closed"}`}
          >
            {/* Sol Men√º  */}
            <div id="sidebar-container">
              <SidebarToggle
                isOpen={sidebarOpen}
                onToggle={() => setSidebarOpen(!sidebarOpen)}
              />
              <NewSidebar
                selectedMain={selectedMain}
                setSelectedMain={setSelectedMain}
                selectedSub={selectedSub}
                setSelectedSub={setSelectedSub}
                currentSubcontractor={currentSubcontractor}
                handleLogout={handleLogout}
              />
            </div>

            {/* Saƒü ƒ∞√ßerik */}
            <div
              className={`${sidebarOpen ? "flex-1" : "w-full"} p-6 overflow-y-auto`}
            >
              <div className="flex justify-between mb-4 gap-2">
                <ExcelUploadButton onExcelDataLoaded={handleExcelDataLoaded} />
                <div className="flex gap-2">
                  <ThemeToggle />
                  <LanguageSelector />
                </div>
              </div>

              <div className="section subcontractor-compact">
                <div className="section-header">
                  <h2 className="text-2xl font-semibold text-gray-700">
                    Alt Y√ºklenici:{" "}
                    <span className="text-gray-900">
                      {currentSubcontractor.name}
                    </span>
                  </h2>
                  <p className="text-gray-700 font-medium">
                    Alt Y√ºklenici No:{" "}
                    <span className="text-gray-900">
                      {currentSubcontractor.number}
                    </span>
                  </p>
                </div>
              </div>

              {/* Proje Bilgisi - √áer√ßevenin dƒ±≈üƒ±nda */}
              <div className="section project-compact">
                <p className="text-lg font-semibold text-blue-700">
                  Proje:{" "}
                  <span className="text-blue-900">
                    {projects.find((p) => p.id === selectedProject)?.name}
                  </span>
                </p>
              </div>

              <div className="section">
                <div className="section-header">
                  <h3 className="section-title">{selectedSub}</h3>

                  {(isReportForm || isManpowerForm) && (
                    <div className="flex items-center space-x-4">
                      <div className="flex items-center">
                        <label className="text-gray-600 text-sm mr-2">
                          Tarih:
                        </label>
                        <input
                          type="date"
                          value={date}
                          onChange={(e) => setDate(e.target.value)}
                          className={inputStyles}
                        />
                      </div>
                      <div className="flex items-center">
                        <label className="text-gray-600 text-sm mr-2">
                          Vardiya:
                        </label>
                        <select
                          value={shift}
                          onChange={(e) => setShift(e.target.value)}
                          className={selectStyles}
                        >
                          {shifts.map((shiftOption, index) => (
                            <option key={index} value={shiftOption.value}>
                              {shiftOption.label}
                            </option>
                          ))}
                        </select>
                      </div>
                    </div>
                  )}
                </div>

                {isReportForm ? (
                  <div className="space-y-6">
                    <div className="form-rows">
                      <div className="category-form-row">
                        <div className="form-group">
                          <label className="form-label">Ana Kategori</label>
                          <select
                            value={mainCategory}
                            onChange={(e) => setMainCategory(e.target.value)}
                            className={selectStyles}
                          >
                            <option value="">Se√ßiniz</option>
                            {initialCategories.mainCategories.map(
                              (cat, index) => (
                                <option key={index} value={cat}>
                                  {cat}
                                </option>
                              ),
                            )}
                          </select>
                        </div>

                        <div className="form-group">
                          <label className="form-label">Alt Kategori</label>
                          <select
                            value={subCategory}
                            onChange={(e) => setSubCategory(e.target.value)}
                            disabled={
                              !mainCategory ||
                              !initialCategories.subCategories[mainCategory]
                            }
                            className={`${selectStyles} subcategory-select`}
                          >
                            <option value="">Se√ßiniz</option>
                            {initialCategories.subCategories[mainCategory]?.map(
                              (subCat, index) => (
                                <option key={index} value={subCat}>
                                  {subCat}
                                </option>
                              ),
                            )}
                          </select>
                        </div>
                      </div>
                    </div>

                    {/* Mechanical Detaylƒ± Kategori Se√ßici */}
                   {isMechanicalWithDetails && (
  <MechanicalSubCategorySelector
    subCategory={subCategory}
    mechanicalDetail={mechanicalDetail}
    mechanicalDetail2={mechanicalDetail2}
    onDetailChange={setMechanicalDetail}
    onDetail2Change={setMechanicalDetail2}
    excelData={excelData} // YENƒ∞: Excel verilerini iletiyoruz
  />
)}

                    {/* Elektrik ve Enstruman Detaylƒ± Kategori Se√ßici */}
                    {isEIWithDetails && (
                      <EIDetailSelector
                        subCategory={subCategory}
                        eiDetail1={eiDetail1}
                        eiDetail2={eiDetail2}
                        onDetail1Change={setEiDetail1}
                        onDetail2Change={setEiDetail2}
                      />
                    )}

                  {isHeatingDeviceForm ? (
  <HeatingDeviceForm
    mechanicalDetail2={mechanicalDetail2}
  />
) : isMechanicalReportForm ? (
  <MechanicalReportForm
    mainCategory={mainCategory}
    subCategory={subCategory}
    mechanicalDetail={mechanicalDetail}
    mechanicalDetail2={mechanicalDetail2}
    excelData={excelData}
  />
) : mainCategory === "Elektrik ve Enstruman" &&
                      (isCablePulling || isCableTermination || isCableTray) ? (
                      <div className="space-y-6">
                        <div className="section-header">
                          <h4 className="section-title">
                            {getCategoryTitle()}
                          </h4>
                          <div className="flex space-x-2">
                            {isCablePulling && (
                              <button
                                onClick={() => setShowCableSchedule(true)}
                                className={buttonStyles.primary}
                              >
                                Cable Schedule
                              </button>
                            )}
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                              <p className="text-blue-700 font-medium">
                                Form No:{" "}
                                <span className="font-bold">√ñRNEK-FORM-NO</span>
                              </p>
                            </div>
                          </div>
                        </div>

                        {/* KABLO √áEKƒ∞M FORM */}
                        {isCablePulling && (
                          <div className="section">
                            <div className="form-rows">
                              <div className="cable-form-row">
                                <div
                                  className="form-group"
                                  style={{ position: "relative" }}
                                >
                                  <label className="form-label">
                                    Cable Tag Number
                                  </label>
                                  <input
                                    value={cableTagInput}
                                    onChange={(e) => {
                                      setCableTagInput(e.target.value);
                                      setCableErrors({
                                        ...cableErrors,
                                        tag: "",
                                      });
                                      setShowCableTagSuggestions(true);
                                    }}
                                    onFocus={() =>
                                      setShowCableTagSuggestions(true)
                                    }
                                    onBlur={() =>
                                      setTimeout(() => {
                                        setShowCableTagSuggestions(false);
                                        validateCableTagInput();
                                      }, 150)
                                    }
                                    placeholder="Kablo etiketini yazƒ±n veya se√ßin"
                                    className={inputStyles}
                                    disabled={!!editingCableId}
                                  />
                                  {showCableTagSuggestions &&
                                    availableCableTags.filter((t) => {
                                      if (!cableTagInput) return true;
                                      return String(t)
                                        .toLowerCase()
                                        .includes(
                                          String(cableTagInput).toLowerCase(),
                                        );
                                    }).length > 0 && (
                                      <div className="suggestions-list">
                                        {availableCableTags
                                          .filter((t) => {
                                            if (!cableTagInput) return true;
                                            return String(t)
                                              .toLowerCase()
                                              .includes(
                                                String(
                                                  cableTagInput,
                                                ).toLowerCase(),
                                              );
                                          })
                                          .map((cable, index) => (
                                            <div
                                              key={index}
                                              className="suggestion-item"
                                              onMouseDown={(e) => {
                                                e.preventDefault();
                                                setCableTagInput(cable);
                                                handleCableTagSelect(cable);
                                                setShowCableTagSuggestions(
                                                  false,
                                                );
                                              }}
                                            >
                                              {cable}
                                            </div>
                                          ))}
                                      </div>
                                    )}
                                  {cableErrors.tag && (
                                    <div className="text-red-500 text-xs mt-1">
                                      {cableErrors.tag}
                                    </div>
                                  )}
                                </div>
                                <div className="form-group">
                                  <div className="flex items-center justify-between mb-1">
                                    <label className="form-label">
                                      Drum Number
                                    </label>
                                    <div className="flex items-center">
                                      <input
                                        type="checkbox"
                                        id="different-drum"
                                        checked={
                                          currentCable.allowDifferentDrum
                                        }
                                        onChange={handleDifferentDrumChange}
                                        className="h-4 w-4 text-blue-600"
                                      />
                                      <label
                                        htmlFor="different-drum"
                                        className="ml-1 text-sm text-gray-600"
                                      >
                                        Farklƒ± Makara
                                      </label>
                                    </div>
                                  </div>
                                  {currentCable.allowDifferentDrum ? (
                                    <select
                                      value={currentCable.differentDrum}
                                      onChange={(e) =>
                                        handleDifferentDrumSelect(
                                          e.target.value,
                                        )
                                      }
                                      className={selectStyles}
                                    >
                                      <option value="">Se√ßiniz</option>
                                      {alternativeDrums.map((drum, index) => (
                                        <option key={index} value={drum}>
                                          {drum}
                                        </option>
                                      ))}
                                    </select>
                                  ) : (
                                    <input
                                      value={currentCable.drumNumber}
                                      readOnly
                                      className={inputStyles}
                                    />
                                  )}
                                </div>

                                <div className="form-group">
                                  <label className="form-label">
                                    Cable Type
                                  </label>
                                  <input
                                    value={currentCable.cableType}
                                    readOnly
                                    className={inputStyles}
                                  />
                                </div>

                                <div className="form-group">
                                  <label className="form-label">
                                    Cable Size
                                  </label>
                                  <input
                                    value={currentCable.size}
                                    readOnly
                                    className={inputStyles}
                                  />
                                </div>
                              </div>

                              <div className="cable-form-row">
                                <div className="form-group">
                                  <label className="form-label">
                                    From (Source)
                                  </label>
                                  <input
                                    value={currentCable.from}
                                    readOnly
                                    className={inputStyles}
                                  />
                                </div>

                                <div className="form-group">
                                  <label className="form-label">
                                    To (User)
                                  </label>
                                  <input
                                    value={currentCable.to}
                                    readOnly
                                    className={inputStyles}
                                  />
                                </div>

                                <div className="form-group">
                                  <label className="form-label">
                                    Drawing Number
                                  </label>
                                  <input
                                    value={currentCable.drawingNumber}
                                    readOnly
                                    className={inputStyles}
                                  />
                                </div>

                                <div className="form-group">
                                  <label className="form-label">Revision</label>
                                  <input
                                    value={currentCable.revision}
                                    readOnly
                                    className={inputStyles}
                                  />
                                </div>
                              </div>

                              <div className="cable-form-row">
                                <div className="form-group">
                                  <label className="form-label">
                                    Start (m)
                                  </label>
                                  <input
                                    type="text"
                                    value={currentCable.start}
                                    onChange={(e) => {
                                      // Kabul edilen giri≈ü: nokta veya virg√ºl
                                      setCurrentCable({
                                        ...currentCable,
                                        start: e.target.value,
                                      });
                                      setCableErrors({
                                        ...cableErrors,
                                        start: "",
                                      });
                                    }}
                                    onBlur={() =>
                                      setCurrentCable((prev) => ({
                                        ...prev,
                                        start: formatDisplayNumberInCableForm(
                                          prev.start,
                                        ),
                                      }))
                                    }
                                    className={inputStyles}
                                    placeholder="0,00"
                                  />
                                  {cableErrors.start && (
                                    <div className="text-red-500 text-xs mt-1">
                                      {cableErrors.start}
                                    </div>
                                  )}
                                </div>

                                <div className="form-group">
                                  <label className="form-label">
                                    Finish (m)
                                  </label>
                                  <input
                                    type="text"
                                    value={currentCable.finish}
                                    onChange={(e) => {
                                      setCurrentCable({
                                        ...currentCable,
                                        finish: e.target.value,
                                      });
                                      setCableErrors({
                                        ...cableErrors,
                                        finish: "",
                                      });
                                    }}
                                    onBlur={() =>
                                      setCurrentCable((prev) => ({
                                        ...prev,
                                        finish: formatDisplayNumberInCableForm(
                                          prev.finish,
                                        ),
                                      }))
                                    }
                                    className={inputStyles}
                                    placeholder="0,00"
                                  />
                                  {cableErrors.finish && (
                                    <div className="text-red-500 text-xs mt-1">
                                      {cableErrors.finish}
                                    </div>
                                  )}
                                </div>

                                <div className="form-group">
                                  <label className="form-label">
                                    Design_Length (m)
                                  </label>
                                  <input
                                    value={currentCable.designLength}
                                    readOnly
                                    className={inputStyles}
                                  />
                                </div>

                                <div className="form-group">
                                  <label className="form-label">
                                    Actual Length (m)
                                  </label>
                                  <input
                                    value={currentCable.actualLength}
                                    readOnly
                                    className={inputStyles}
                                  />
                                </div>
                              </div>

                              {/* NOTLAR ALANI */}
                              <div className="form-group">
                                <label className="form-label">Note:</label>
                                <textarea
                                  value={currentCable.notes}
                                  onChange={(e) =>
                                    setCurrentCable({
                                      ...currentCable,
                                      notes: e.target.value,
                                    })
                                  }
                                  placeholder="Not ekle..."
                                  className="form-textarea h-20"
                                />
                              </div>

                              <div className="flex justify-end space-x-2">
                                {editingCableId && (
                                  <button
                                    onClick={handleCancelEdit}
                                    className={buttonStyles.secondary}
                                  >
                                    ƒ∞ptal
                                  </button>
                                )}
                                <button
                                  onClick={handleAddCable}
                                  className={buttonStyles.success}
                                  disabled={
                                    cableList.length >= 10 && !editingCableId
                                  }
                                >
                                  {editingCableId
                                    ? "G√ºncelle"
                                    : `+ Ekle (${cableList.length}/10)`}
                                </button>
                              </div>

                              {/* Kablo Listesi Tablosu */}
                              {cableList.length > 0 && (
                                <div className="mt-6">
                                  <h4 className="section-title">
                                    Eklenen Kablolar
                                  </h4>
                                  <div className="manpower-table-container">
                                    <table
                                      className="data-table"
                                      style={{
                                        tableLayout: "fixed",
                                        width: "100%",
                                        fontSize: "0.7rem",
                                      }}
                                    >
                                      <thead>
                                        <tr>
                                          <th style={{ width: "12%" }}>
                                            Cable Tag
                                          </th>
                                          <th style={{ width: "5%" }}>Type</th>
                                          <th style={{ width: "7%" }}>Size</th>
                                          <th style={{ width: "9%" }}>From</th>
                                          <th style={{ width: "9%" }}>To</th>
                                          <th style={{ width: "8%" }}>
                                            Design (m)
                                          </th>
                                          <th style={{ width: "8%" }}>
                                            Actual (m)
                                          </th>
                                          <th style={{ width: "6%" }}>
                                            Start (m)
                                          </th>
                                          <th style={{ width: "6%" }}>
                                            Finish (m)
                                          </th>
                                          <th style={{ width: "8%" }}>
                                            Drum No
                                          </th>
                                          <th style={{ width: "8%" }}>
                                            Drawing
                                          </th>
                                          <th style={{ width: "4%" }}>Rev</th>
                                          <th style={{ width: "5%" }}>Note</th>
                                          <th style={{ width: "5%" }}>ƒ∞≈ülem</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        {cableList.map((cable) => (
                                          <tr key={cable.id}>
                                            <td
                                              style={{
                                                overflow: "hidden",
                                                textOverflow: "ellipsis",
                                                whiteSpace: "nowrap",
                                                fontSize: "0.7rem",
                                              }}
                                              title={cable.tag}
                                            >
                                              {cable.tag}
                                            </td>
                                            <td
                                              style={{
                                                overflow: "hidden",
                                                textOverflow: "ellipsis",
                                                whiteSpace: "nowrap",
                                                fontSize: "0.7rem",
                                              }}
                                              title={cable.cableType}
                                            >
                                              {cable.cableType}
                                            </td>
                                            <td style={{ fontSize: "0.7rem" }}>
                                              {cable.size}
                                            </td>
                                            <td
                                              style={{
                                                overflow: "hidden",
                                                textOverflow: "ellipsis",
                                                whiteSpace: "nowrap",
                                                fontSize: "0.7rem",
                                              }}
                                              title={cable.from}
                                            >
                                              {cable.from}
                                            </td>
                                            <td
                                              style={{
                                                overflow: "hidden",
                                                textOverflow: "ellipsis",
                                                whiteSpace: "nowrap",
                                                fontSize: "0.7rem",
                                              }}
                                              title={cable.to}
                                            >
                                              {cable.to}
                                            </td>
                                            <td style={{ fontSize: "0.7rem" }}>
                                              {cable.designLength}
                                            </td>
                                            <td style={{ fontSize: "0.7rem" }}>
                                              {cable.actualLength}
                                            </td>
                                            <td style={{ fontSize: "0.7rem" }}>
                                              {cable.start}
                                            </td>
                                            <td style={{ fontSize: "0.7rem" }}>
                                              {cable.finish}
                                            </td>
                                            <td style={{ fontSize: "0.7rem" }}>
                                              {cable.drumNumber}
                                            </td>
                                            <td
                                              style={{
                                                overflow: "hidden",
                                                textOverflow: "ellipsis",
                                                whiteSpace: "nowrap",
                                                fontSize: "0.7rem",
                                              }}
                                              title={cable.drawingNumber}
                                            >
                                              {cable.drawingNumber}
                                            </td>
                                            <td style={{ fontSize: "0.7rem" }}>
                                              {cable.revision}
                                            </td>
                                            <td
                                              style={{ fontSize: "0.7rem" }}
                                              title={cable.notes}
                                            >
                                              {cable.notes ? "Available" : "-"}
                                            </td>
                                            <td>
                                              <div
                                                className="compact-action-buttons"
                                                style={{
                                                  display: "flex",
                                                  flexDirection: "column",
                                                  gap: "2px",
                                                }}
                                              >
                                                <button
                                                  onClick={() =>
                                                    handleEditCable(cable.id)
                                                  }
                                                  className={`${buttonStyles.edit} ${buttonStyles.small} compact-button`}
                                                  style={{
                                                    padding: "2px 4px",
                                                    fontSize: "0.6rem",
                                                    lineHeight: "1",
                                                    minHeight: "auto",
                                                  }}
                                                >
                                                  D√ºzenle
                                                </button>
                                                <button
                                                  onClick={() =>
                                                    handleDeleteCable(cable.id)
                                                  }
                                                  className={`${buttonStyles.danger} ${buttonStyles.small} compact-button`}
                                                  style={{
                                                    padding: "2px 4px",
                                                    fontSize: "0.6rem",
                                                    lineHeight: "1",
                                                    minHeight: "auto",
                                                  }}
                                                >
                                                  Sil
                                                </button>
                                              </div>
                                            </td>
                                          </tr>
                                        ))}
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              )}
                            </div>
                          </div>
                        )}

                        {/* KABLO TERMƒ∞NASYON FORM */}
                        {isCableTermination && (
                          <div className="section">
                            <div className="form-rows">
                              {/* Cable Tag Number, Cable Type, Cable Size tek satƒ±rda */}
                              <div className="termination-first-row">
                                <div className="form-group">
                                  <label className="form-label">
                                    Cable Tag Number
                                  </label>
                                  <input
                                    value={currentTerminationCable.tag}
                                    onChange={(e) =>
                                      setCurrentTerminationCable({
                                        ...currentTerminationCable,
                                        tag: e.target.value,
                                      })
                                    }
                                    placeholder="Kablo etiketini yazƒ±n"
                                    className={inputStyles}
                                  />
                                </div>
                                <div className="form-group">
                                  <label className="form-label">
                                    Cable Type
                                  </label>
                                  <input
                                    value={currentTerminationCable.cableType}
                                    onChange={(e) =>
                                      setCurrentTerminationCable({
                                        ...currentTerminationCable,
                                        cableType: e.target.value,
                                      })
                                    }
                                    className={inputStyles}
                                  />
                                </div>
                                <div className="form-group">
                                  <label className="form-label">
                                    Cable Size
                                  </label>
                                  <input
                                    value={currentTerminationCable.size}
                                    onChange={(e) =>
                                      setCurrentTerminationCable({
                                        ...currentTerminationCable,
                                        size: e.target.value,
                                      })
                                    }
                                    className={inputStyles}
                                  />
                                </div>
                              </div>

                              {/* From ve To geni≈ületilmi≈ü */}
                              <div className="termination-second-row">
                                <div className="form-group">
                                  <label className="form-label">
                                    From (Source)
                                  </label>
                                  <div className="flex items-center">
                                    <input
                                      value={currentTerminationCable.from}
                                      onChange={(e) =>
                                        setCurrentTerminationCable({
                                          ...currentTerminationCable,
                                          from: e.target.value,
                                        })
                                      }
                                      className={`flex-1 form-input termination-from-to`}
                                    />
                                    <div className="ml-2 flex items-center">
                                      <input
                                        type="checkbox"
                                        checked={
                                          currentTerminationCable.fromTerminated
                                        }
                                        onChange={(e) =>
                                          setCurrentTerminationCable({
                                            ...currentTerminationCable,
                                            fromTerminated: e.target.checked,
                                          })
                                        }
                                        className="h-4 w-4 text-blue-600"
                                      />
                                      <label className="ml-1 text-sm text-gray-600">
                                        Termination
                                      </label>
                                    </div>
                                  </div>
                                </div>
                                <div className="form-group">
                                  <label className="form-label">
                                    To (User)
                                  </label>
                                  <div className="flex items-center">
                                    <input
                                      value={currentTerminationCable.to}
                                      onChange={(e) =>
                                        setCurrentTerminationCable({
                                          ...currentTerminationCable,
                                          to: e.target.value,
                                        })
                                      }
                                      className={`flex-1 form-input termination-from-to`}
                                    />
                                    <div className="ml-2 flex items-center">
                                      <input
                                        type="checkbox"
                                        checked={
                                          currentTerminationCable.toTerminated
                                        }
                                        onChange={(e) =>
                                          setCurrentTerminationCable({
                                            ...currentTerminationCable,
                                            toTerminated: e.target.checked,
                                          })
                                        }
                                        className="h-4 w-4 text-blue-600"
                                      />
                                      <label className="ml-1 text-sm text-gray-600">
                                        Termination
                                      </label>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              {/* NOTLAR ALANI */}
                              <div className="form-group">
                                <label className="form-label">Note:</label>
                                <textarea
                                  value={currentTerminationCable.notes}
                                  onChange={(e) =>
                                    setCurrentTerminationCable({
                                      ...currentTerminationCable,
                                      notes: e.target.value,
                                    })
                                  }
                                  placeholder="Not ekle..."
                                  className="form-textarea h-20"
                                />
                              </div>

                              <div className="flex justify-end">
                                <button className={buttonStyles.success}>
                                  + Ekle (0/10)
                                </button>
                              </div>
                            </div>
                          </div>
                        )}

                        {/* GENEL NOTLAR KUTUSU */}
                        {(isCablePulling ||
                          isCableTermination ||
                          isCableTray) && (
                          <div className="section">
                            <h5 className="section-title">Genel Notlar</h5>
                            <textarea
                              value={generalNotes}
                              onChange={(e) => setGeneralNotes(e.target.value)}
                              placeholder="Genel notlarƒ± buraya giriniz"
                              className="form-textarea h-24"
                            />
                          </div>
                        )}

                        <div className="flex space-x-4">
                          {(isCablePulling ||
                            isCableTermination ||
                            isCableTray) && (
                            <button className={buttonStyles.primary}>
                              Raporu Kaydet
                            </button>
                          )}
                          <button className={buttonStyles.secondary}>
                            Formu Temizle
                          </button>
                        </div>

                        {/* Cable Schedule Modal */}
                        {showCableSchedule && (
                          <CableSchedulePreview
                            excelData={excelData}
                            eiDetail1={eiDetail1}
                            onClose={() => setShowCableSchedule(false)}
                          />
                        )}
                      </div>
                    ) : mainCategory && subCategory ? (
                      <div className="section">
                        <p className="text-blue-700 font-medium text-center">
                          üöß {mainCategory} - {subCategory} i√ßin form hazƒ±rlƒ±k
                          a≈üamasƒ±ndadƒ±r.
                        </p>
                        <p className="text-blue-600 mt-2 text-center">
                          Bu sadece g√∂rsel bir ≈üablondur.
                        </p>
                      </div>
                    ) : null}
                  </div>
                ) : isManpowerForm ? (
                  <div>
                    <ManpowerForm
                      personnel={[]}
                      onSave={() => {}}
                      subcontractor={currentSubcontractor}
                      date={date}
                      shift={shift}
                      onDateChange={setDate}
                      onShiftChange={setShift}
                      excelData={excelData}
                      currentSubcontractor={currentSubcontractor}
                    />
                  </div>
                ) : isEquipmentReport ? (
                  <EquipmentReportForm
                    date={date}
                    shift={shift}
                    onDateChange={setDate}
                    onShiftChange={setShift}
                    excelData={excelData}
                    currentSubcontractor={currentSubcontractor}
                  />
                ) : isAllReports ? (
                  <AllReportsView
                    allReports={[]}
                    currentSubcontractor={currentSubcontractor}
                  />
                ) : isRFIForm ? (
                  <RFIForm currentSubcontractor={currentSubcontractor} />
                ) : isNCRForm ? (
                  <NCRReportsView />
                ) : (
                  <div className="section">
                    <p className="text-blue-700 font-medium text-center">
                      üöß {selectedSub} formu hazƒ±rlƒ±k a≈üamasƒ±ndadƒ±r.
                    </p>
                    <p className="text-blue-600 mt-2 text-center">
                      Bu sadece g√∂rsel bir ≈üablondur.
                    </p>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      // D√úZELTME: ReactDOM.createRoot doƒüru kullanƒ±mƒ±
      const container = document.getElementById("root");
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
    </script>
  </body>
</html>

